<!-- Generated by SpecStory -->

# 2025-12-21 17:37:50Z

<!-- Claude Code Session 1cf4daaa-7537-46b3-a6f4-0c07bf519f5b (2025-12-21_17-37-50Z) -->

_**User (sidechain)**_

Explore the CLI implementation in this codebase. I need to understand:

1. What CLI commands exist and what they do
2. The current architecture and flow
3. Any documentation about the CLI
4. How phases/workflows are currently structured

Look for:
- CLI-related files (cli.ts, commands/, etc.)
- Any CLI documentation or guides
- Phase/workflow implementations
- Dashboard or status-related code

Be thorough - check docs/, src/, and any CLI-specific directories.

---

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

I'll explore the CLI implementation in this codebase thoroughly. Let me start by finding all CLI-related files and documentation.

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Glob**

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Glob**

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Glob**

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Glob**

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** Find CLI documentation files

`find /Users/dfotesco/Portfolio/portfolio -type f -name "*.md" | grep -i cli | head -20`

Result:

```
/Users/dfotesco/Portfolio/portfolio/node_modules/cliui/CHANGELOG.md
/Users/dfotesco/Portfolio/portfolio/node_modules/cliui/README.md
/Users/dfotesco/Portfolio/portfolio/node_modules/cli-cursor/readme.md
/Users/dfotesco/Portfolio/portfolio/node_modules/framer-motion/client/README.md
/Users/dfotesco/Portfolio/portfolio/node_modules/cli-spinners/readme.md
/Users/dfotesco/Portfolio/portfolio/.specstory/history/2025-12-21_17-37-50Z-explore-the-cli-implementation.md
/Users/dfotesco/Portfolio/portfolio/docs/guides/universal-cv-cli.md
```

Result:

```
/Users/dfotesco/Portfolio/portfolio/docs/history/2024-12-refactor.md
/Users/dfotesco/Portfolio/portfolio/docs/history/original-ai-prompt.md
/Users/dfotesco/Portfolio/portfolio/docs/history/2025-12-consolidation-strategy.md
/Users/dfotesco/Portfolio/portfolio/docs/history/2025-12-audit-implementation.md
/Users/dfotesco/Portfolio/portfolio/docs/history/2025-12-consolidated-walkthrough.md
/Users/dfotesco/Portfolio/portfolio/docs/history/case-study-drawer-redesign.md
/Users/dfotesco/Portfolio/portfolio/docs/history/polish-integration-walkthrough.md
/Users/dfotesco/Portfolio/portfolio/docs/guides/adding-case-studies.md
/Users/dfotesco/Portfolio/portfolio/docs/guides/universal-cv.md
/Users/dfotesco/Portfolio/portfolio/docs/CONTENT.md
/Users/dfotesco/Portfolio/portfolio/node_modules/@adobe/css-tools/docs/API.md
/Users/dfotesco/Portfolio/portfolio/node_modules/@adobe/css-tools/docs/AST.md
/Users/dfotesco/Portfolio/portfolio/node_modules/@adobe/css-tools/docs/CHANGELOG.md
/Users/dfotesco/Portfolio/portfolio/node_modules/@adobe/css-tools/docs/EXAMPLES.md
/Users/dfotesco/Portfolio/portfolio/docs/COMPLETE_WORKFLOW.md
/Users/dfotesco/Portfolio/portfolio/docs/JOB_HUNTING_PLAYBOOK.md
/Users/dfotesco/Portfolio/portfolio/docs/gap-analysis.md
/Users/dfotesco/Portfolio/portfolio/docs/data-ingestion-process-log.md
/Users/dfotesco/Portfolio/portfolio/docs/guides/cv-data-ingestion.md
/Users/dfotesco/Portfolio/portfolio/docs/history/AGENT_RULES.md
/Users/dfotesco/Portfolio/portfolio/docs/history/ROADMAP.md
/Users/dfotesco/Portfolio/portfolio/node_modules/smart-buffer/docs/CHANGELOG.md
/Users/dfotesco/Portfolio/portfolio/node_modules/smart-buffer/docs/README_v3.md
/Users/dfotesco/Portfolio/portfolio/node_modules/smart-buffer/docs/ROADMAP.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/examples/javascript/associateExample.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/examples/typescript/associateExample.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/examples/javascript/bindExample.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/examples/typescript/bindExample.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/examples/javascript/connectExample.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/examples/typescript/connectExample.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/examples/index.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/index.md
/Users/dfotesco/Portfolio/portfolio/node_modules/socks/docs/migratingFromV1.md
/Users/dfotesco/Portfolio/portfolio/docs/guides/capstone-workflow.md
/Users/dfotesco/Portfolio/portfolio/docs/guides/universal-cv-cli.md
```

Result:

```
No files found
```

Result:

```
/Users/dfotesco/Portfolio/portfolio/node_modules/why-is-node-running/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/react-dom/client.js
/Users/dfotesco/Portfolio/portfolio/node_modules/loose-envify/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/json5/lib/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/update-browserslist-db/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/tldts/bin/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/react-dom/client.react-server.js
/Users/dfotesco/Portfolio/portfolio/node_modules/browserslist/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/framer-motion/dist/cjs/client.js
/Users/dfotesco/Portfolio/portfolio/node_modules/@types/react-dom/client.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/vite-node/dist/cli.cjs
/Users/dfotesco/Portfolio/portfolio/node_modules/vite-node/dist/client.cjs
/Users/dfotesco/Portfolio/portfolio/node_modules/undici-types/client-stats.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/undici-types/client.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/react-helmet-async/lib/client.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/baseline-browser-mapping/dist/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/vite/dist/node/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/vite-node/dist/cli.mjs
/Users/dfotesco/Portfolio/portfolio/node_modules/vite-node/dist/client.mjs
/Users/dfotesco/Portfolio/portfolio/node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js
/Users/dfotesco/Portfolio/portfolio/node_modules/vitest/dist/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/vite-node/dist/cli.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/tsx/dist/cli.cjs
/Users/dfotesco/Portfolio/portfolio/node_modules/vite-node/dist/client.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/tsx/dist/client-D6NvIMSC.cjs
/Users/dfotesco/Portfolio/portfolio/node_modules/cssstyle/lib/properties/clip.js
/Users/dfotesco/Portfolio/portfolio/node_modules/refractor/lang/clike.js
/Users/dfotesco/Portfolio/portfolio/node_modules/eslint/lib/cli-engine/cli-engine.js
/Users/dfotesco/Portfolio/portfolio/node_modules/eslint/lib/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/tsx/dist/cli.mjs
/Users/dfotesco/Portfolio/portfolio/node_modules/tsx/dist/client-BQVF1NaW.mjs
/Users/dfotesco/Portfolio/portfolio/node_modules/caniuse-lite/data/features/client-hints-dpr-width-viewport.js
/Users/dfotesco/Portfolio/portfolio/node_modules/caniuse-lite/data/features/clipboard.js
/Users/dfotesco/Portfolio/portfolio/node_modules/vite/dist/client/client.mjs
/Users/dfotesco/Portfolio/portfolio/node_modules/vite/client.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/framer-motion/dist/es/client.mjs
/Users/dfotesco/Portfolio/portfolio/node_modules/yaml/dist/cli.mjs
/Users/dfotesco/Portfolio/portfolio/node_modules/yaml/dist/cli.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/react-syntax-highlighter/dist/cjs/languages/prism/clike.js
/Users/dfotesco/Portfolio/portfolio/node_modules/react-syntax-highlighter/dist/esm/languages/prism/clike.js
/Users/dfotesco/Portfolio/portfolio/node_modules/react-syntax-highlighter/src/languages/prism/clike.js
/Users/dfotesco/Portfolio/portfolio/node_modules/refractor/lang/clike.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/framer-motion/dist/types/client.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/.vite/deps/clike-VL6ORET3.js.map
/Users/dfotesco/Portfolio/portfolio/node_modules/.vite/deps/clike-VL6ORET3.js
/Users/dfotesco/Portfolio/portfolio/node_modules/extract-zip/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/cjs/puppeteer/node/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/esm/puppeteer/node/cli.js
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/cjs/puppeteer/node/cli.d.ts.map
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/esm/puppeteer/node/cli.d.ts.map
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/cjs/puppeteer/node/cli.js.map
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/esm/puppeteer/node/cli.js.map
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/cjs/puppeteer/node/cli.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/lib/esm/puppeteer/node/cli.d.ts
/Users/dfotesco/Portfolio/portfolio/node_modules/puppeteer/src/node/cli.ts
```

Result:

```
/Users/dfotesco/Portfolio/portfolio/node_modules/aria-query/lib/etc/roles/abstract/commandRole.js
/Users/dfotesco/Portfolio/portfolio/node_modules/yargs/build/lib/command.js
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Good! Now let me look at the actual source files in the project:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** Find TypeScript files related to CLI, commands, or phases

`find /Users/dfotesco/Portfolio/portfolio/src -type f \( -name "*.ts" -o -name "*.tsx" \) | grep -E "(cli|command|phase)" | head -20`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** List source directory structure

`ls -la /Users/dfotesco/Portfolio/portfolio/src/ 2>/dev/null | head -30`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./`

Error:

```
EISDIR: illegal operation on a directory, read
```

Result:

```
total 24
drwxr-xr-x@ 12 dfotesco  staff   384 Dec 21 12:20 .
drwxr-xr-x@ 35 dfotesco  staff  1120 Dec 21 12:20 ..
-rw-r--r--@  1 dfotesco  staff   906 Dec 21 12:20 App.tsx
drwxr-xr-x@ 10 dfotesco  staff   320 Dec 21 12:20 components
drwxr-xr-x@  4 dfotesco  staff   128 Dec 18 06:16 context
-rw-r--r--@  1 dfotesco  staff  1211 Dec 19 16:32 index.css
drwxr-xr-x@  6 dfotesco  staff   192 Dec 18 06:16 lib
-rw-r--r--@  1 dfotesco  staff   230 Dec 10 12:54 main.tsx
drwxr-xr-x@  5 dfotesco  staff   160 Dec 21 12:20 pages
drwxr-xr-x@  3 dfotesco  staff    96 Dec 21 12:20 styles
drwxr-xr-x@  9 dfotesco  staff   288 Dec 19 14:47 tests
drwxr-xr-x@  6 dfotesco  staff   192 Dec 18 06:16 types
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Let me search more strategically for CLI-related files:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** List all TypeScript files in src

`find /Users/dfotesco/Portfolio/portfolio/src -type f \( -name "*.ts" -o -name "*.tsx" \) | head -40`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./docs/guides/universal-cv-cli.md`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./docs/guides/capstone-workflow.md`

Result:

```
1→# Universal CV CLI Guide
     2→
     3→A complete guide to using the Universal CV quality pipeline CLI — from creating a new variant to shipping it.
     4→
     5→---
     6→
     7→## The Pipeline at a Glance
     8→
     9→\```
    10→┌─────────────────────────────────────────────────────────────────────────────┐
    11→│                        UNIVERSAL CV QUALITY PIPELINE                         │
    12→├─────────────────────────────────────────────────────────────────────────────┤
    13→│                                                                              │
    14→│   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌───────┐│
    15→│   │  CREATE  │ →  │   SYNC   │ →  │ EVALUATE │ →  │ RED TEAM │ →  │ SHIP  ││
    16→│   └──────────┘    └──────────┘    └──────────┘    └──────────┘    └───────┘│
    17→│                                                                              │
    18→│   Copy template     YAML→JSON     Extract claims   Adversarial   Deploy    │
    19→│   Edit for role     Validate      Find sources     scans         variant   │
    20→│                     schema        Verify facts     Gate check              │
    21→│                                                                              │
    22→└─────────────────────────────────────────────────────────────────────────────┘
    23→\```
    24→
    25→---
    26→
    27→## Phase 1: Create a New Variant
    28→
    29→### Step 1.1: Copy the Template
    30→
    31→\```bash
    32→cp content/variants/_template.yaml content/variants/acme-senior-pm.yaml
    33→\```
    34→
    35→### Step 1.2: Edit the Variant
    36→
    37→Open `content/variants/acme-senior-pm.yaml` and customize:
    38→
    39→\```yaml
    40→# content/variants/acme-senior-pm.yaml
    41→metadata:
    42→  slug: acme-senior-pm          # Must match filename!
    43→  company: Acme Corp
    44→  role: Senior Product Manager
    45→  jobUrl: https://acme.com/jobs/senior-pm
    46→  jobDescription: |
    47→    We're looking for a Senior PM to lead our developer platform...
    48→
    49→overrides:
    50→  hero:
    51→    headline: "Building Developer Platforms That Scale"
    52→    subheadline: |
    53→      Senior Technical PM with 8 years shipping developer-facing products—
    54→      from enterprise APIs to Web3 infrastructure.
    55→
    56→  about:
    57→    bio:
    58→      - |
    59→        I've shipped 7+ L2 protocol integrations with consistent API patterns
    60→        that reduced integration time by 60%.
    61→    stats:
    62→      - value: "8+"
    63→        label: "Years Experience"
    64→      - value: "$50M+"
    65→        label: "Revenue Impact"
    66→\```
    67→
    68→**Key Rules**:
    69→- `metadata.slug` MUST match the filename (without `.yaml`)
    70→- All metrics should be traceable to knowledge base entries
    71→- Keep `jobDescription` under 1200 chars (shown publicly in JSON)
    72→
    73→---
    74→
    75→## Phase 2: Sync Variants
    76→
    77→**Purpose**: Convert YAML (human-editable) → JSON (runtime artifact)
    78→
    79→### Command
    80→
    81→\```bash
    82→npm run variants:sync
    83→\```
    84→
    85→### What You'll See
    86→
    87→\```
    88→╭─────────────────────────────────────────────────────────────────────────────╮
    89→│  ◆ Universal CV                                          Quality Pipeline  │
    90→╰─────────────────────────────────────────────────────────────────────────────╯
    91→
    92→⠋ Syncing variants...
    93→
    94→Syncing variants
    95→/Users/you/portfolio/content/variants
    96→
    97→✓ acme-senior-pm (created)
    98→✓ bloomberg-technical-product-manager (in sync)
    99→✓ mysten-walrus-senior-pm (in sync)
   100→✓ stripe-crypto (in sync)
   101→
   102→Summary: 4 variant(s), 1 updated, 0 errors
   103→\```
   104→
   105→### Status Icons
   106→
   107→| Icon | Meaning |
   108→|------|---------|
   109→| ✓ `(created)` | New JSON file created |
   110→| ✓ `(updated)` | JSON updated to match YAML |
   111→| ✓ `(in sync)` | JSON already matches YAML |
   112→| ✗ `error` | Validation failed |
   113→
   114→### Sync a Single Variant
   115→
   116→\```bash
   117→npm run variants:sync -- --slug acme-senior-pm
   118→\```
   119→
   120→### Check Mode (CI)
   121→
   122→\```bash
   123→npm run variants:check
   124→\```
   125→
   126→Exits with code `1` if any drift detected (useful for CI pipelines).
   127→
   128→### JSON Output
   129→
   130→\```bash
   131→npm run variants:sync -- --json
   132→\```
   133→
   134→\```json
   135→{
   136→  "mode": "sync",
   137→  "variants": [
   138→    { "slug": "acme-senior-pm", "status": "created" },
   139→    { "slug": "bloomberg-technical-product-manager", "status": "synced" }
   140→  ],
   141→  "errors": []
   142→}
   143→\```
   144→
   145→---
   146→
   147→## Phase 3: Evaluate Claims
   148→
   149→**Purpose**: Extract metrics, find sources, create verification ledger
   150→
   151→### Command
   152→
   153→\```bash
   154→npm run eval:variant -- --slug acme-senior-pm
   155→\```
   156→
   157→### What You'll See
   158→
   159→\```
   160→╭─────────────────────────────────────────────────────────────────────────────╮
   161→│  ◆ Universal CV                                          Quality Pipeline  │
   162→╰─────────────────────────────────────────────────────────────────────────────╯
   163→
   164→⠋ Evaluating variants...
   165→
   166→Evaluating variants
   167→1 variant(s)
   168→
   169→✓ acme-senior-pm: 5 claims, 0 verified, 5 unverified
   170→  capstone/develop/evals/acme-senior-pm.claims.yaml
   171→
   172→Summary: 1 variant(s), 0 verified, 5 unverified
   173→\```
   174→
   175→### Output Files Created
   176→
   177→\```
   178→capstone/develop/evals/
   179→├── acme-senior-pm.claims.yaml    ← Machine-readable claims ledger
   180→└── acme-senior-pm.eval.md        ← Human-readable checklist
   181→\```
   182→
   183→### Understanding the Claims Ledger
   184→
   185→Open `capstone/develop/evals/acme-senior-pm.claims.yaml`:
   186→
   187→\```yaml
   188→version: 1
   189→variant:
   190→  slug: acme-senior-pm
   191→  evaluatedAt: 2025-12-21T18:30:00.000Z
   192→
   193→claims:
   194→  - id: metric-abc123
   195→    location: overrides.hero.subheadline
   196→    text: "Senior Technical PM with 8 years..."
   197→    anchors:
   198→      - "8 years"
   199→    candidateSources:
   200→      - path: content/experience/index.yaml
   201→        score: 0.85
   202→        matchedAnchors: ["8 years"]
   203→        note: "anchors 1/1 • overlap 60%"
   204→    verified:
   205→      status: unverified      # ← YOU NEED TO UPDATE THIS
   206→      sources: []
   207→      notes: ""
   208→\```
   209→
   210→### How to Verify Claims
   211→
   212→For each claim, check the `candidateSources` and update `verified`:
   213→
   214→**Before** (unverified):
   215→\```yaml
   216→verified:
   217→  status: unverified
   218→  sources: []
   219→  notes: ""
   220→\```
   221→
   222→**After** (verified):
   223→\```yaml
   224→verified:
   225→  status: verified
   226→  sources:
   227→    - content/experience/index.yaml
   228→  notes: "Employment dates 2017-2025 confirm 8 years"
   229→\```
   230→
   231→### Evaluate All Variants
   232→
   233→\```bash
   234→npm run eval:all
   235→\```
   236→
   237→\```
   238→╭─────────────────────────────────────────────────────────────────────────────╮
   239→│  ◆ Universal CV                                          Quality Pipeline  │
   240→╰─────────────────────────────────────────────────────────────────────────────╯
   241→
   242→⠋ Evaluating variants...
   243→
   244→Evaluating variants
   245→4 variant(s)
   246→
   247→✓ acme-senior-pm: 5 claims, 5 verified, 0 unverified
   248→✓ bloomberg-technical-product-manager: 8 claims, 8 verified, 0 unverified
   249→⚠ mysten-walrus-senior-pm: 6 claims, 4 verified, 2 unverified
   250→✓ stripe-crypto: 4 claims, 4 verified, 0 unverified
   251→
   252→Summary: 4 variant(s), 21 verified, 2 unverified
   253→\```
   254→
   255→---
   256→
   257→## Phase 4: Red Team Scan
   258→
   259→**Purpose**: Adversarial checks for security, tone, and accuracy risks
   260→
   261→### Command
   262→
   263→\```bash
   264→npm run redteam:variant -- --slug acme-senior-pm
   265→\```
   266→
   267→### What You'll See
   268→
   269→\```
   270→╭─────────────────────────────────────────────────────────────────────────────╮
   271→│  ◆ Universal CV                                          Quality Pipeline  │
   272→╰─────────────────────────────────────────────────────────────────────────────╯
   273→
   274→⠋ Running red team scans...
   275→
   276→Red Team Scan
   277→1 variant(s)
   278→
   279→✓ acme-senior-pm passed
   280→  capstone/develop/redteam/acme-senior-pm.redteam.md
   281→
   282→Summary: 1 passed, 0 warnings, 0 failed
   283→\```
   284→
   285→### When Issues Are Found
   286→
   287→\```
   288→╭─────────────────────────────────────────────────────────────────────────────╮
   289→│  ◆ Universal CV                                          Quality Pipeline  │
   290→╰─────────────────────────────────────────────────────────────────────────────╯
   291→
   292→⠋ Running red team scans...
   293→
   294→Red Team Scan
   295→1 variant(s)
   296→
   297→✗ acme-senior-pm 1 FAIL 2 WARN
   298→  capstone/develop/redteam/acme-senior-pm.redteam.md
   299→
   300→Summary: 0 passed, 0 warnings, 1 failed
   301→\```
   302→
   303→### Red Team Report
   304→
   305→Check `capstone/develop/redteam/acme-senior-pm.redteam.md`:
   306→
   307→\```markdown
   308→# Red Team Report
   309→
   310→- Variant: `acme-senior-pm`
   311→- Generated: 2025-12-21T18:45:00.000Z
   312→
   313→## Summary
   314→
   315→- FAIL: **1**
   316→- WARN: **2**
   317→
   318→## Checks
   319→
   320→| ID | Result | Check |
   321→|---|---|---|
   322→| `RT-ACC-CLAIMS` | ❌ FAIL | Claims ledger exists and is verified |
   323→| `RT-SEC-SECRETS` | ✅ PASS | Secrets / tokens accidentally committed |
   324→| `RT-TONE-SYCOPHANCY` | ⚠️ WARN | Sycophancy / empty praise |
   325→| `RT-ACC-INFLATION` | ⚠️ WARN | Approximation language near metrics |
   326→| ... | ... | ... |
   327→
   328→## Details
   329→
   330→### RT-ACC-CLAIMS — Claims ledger exists and is verified
   331→
   332→- 2 unverified claims remain
   333→- Run: npm run eval:variant -- --slug acme-senior-pm
   334→\```
   335→
   336→### Red Team Checks Reference
   337→
   338→| Check ID | Severity | What It Catches |
   339→|----------|----------|-----------------|
   340→| `RT-ACC-CLAIMS` | FAIL | Missing or unverified claims |
   341→| `RT-SEC-SECRETS` | FAIL | API keys, tokens in text |
   342→| `RT-SEC-CONFIDENTIAL` | FAIL | NDA/confidential language |
   343→| `RT-TONE-SYCOPHANCY` | WARN | "thrilled", "dream company", etc. |
   344→| `RT-ACC-INFLATION` | WARN | "about 15×" near metrics |
   345→| `RT-INPUT-INJECTION` | WARN | Prompt injection in job description |
   346→| `RT-PRIV-JD` | WARN | Job description >1200 chars |
   347→| `RT-XVAR-CONTAM` | WARN | Mentions other target company |
   348→
   349→### Red Team All Variants
   350→
   351→\```bash
   352→npm run redteam:all
   353→\```
   354→
   355→\```
   356→╭─────────────────────────────────────────────────────────────────────────────╮
   357→│  ◆ Universal CV                                          Quality Pipeline  │
   358→╰─────────────────────────────────────────────────────────────────────────────╯
   359→
   360→⠋ Running red team scans...
   361→
   362→Red Team Scan
   363→4 variant(s)
   364→
   365→✓ acme-senior-pm passed
   366→✗ bloomberg-technical-product-manager 1 FAIL 0 WARN
   367→  capstone/develop/redteam/bloomberg-technical-product-manager.redteam.md
   368→⚠ mysten-walrus-senior-pm 0 WARN
   369→  capstone/develop/redteam/mysten-walrus-senior-pm.redteam.md
   370→✓ stripe-crypto passed
   371→
   372→Summary: 2 passed, 1 warnings, 1 failed
   373→\```
   374→
   375→---
   376→
   377→## Phase 5: Gate Check (Ship Decision)
   378→
   379→**Purpose**: Pass/fail gate before deployment
   380→
   381→### Commands
   382→
   383→\```bash
   384→# Check all variants have verified claims
   385→npm run eval:check
   386→
   387→# Check all variants pass red team (WARN ok)
   388→npm run redteam:check
   389→
   390→# Strict mode (WARN = FAIL)
   391→npm run redteam:check -- --strict
   392→\```
   393→
   394→### Gate Flow Diagram
   395→
   396→\```
   397→┌─────────────────────────────────────────────────────────────────────────────┐
   398→│                              GATE CHECK FLOW                                 │
   399→├─────────────────────────────────────────────────────────────────────────────┤
   400→│                                                                              │
   401→│   npm run eval:check                                                         │
   402→│         │                                                                    │
   403→│         ▼                                                                    │
   404→│   ┌───────────────┐                                                         │
   405→│   │ All claims    │──── NO ────▶ Exit 1 (FAIL)                              │
   406→│   │ verified?     │                                                         │
   407→│   └───────────────┘                                                         │
   408→│         │ YES                                                                │
   409→│         ▼                                                                    │
   410→│   npm run redteam:check                                                      │
   411→│         │                                                                    │
   412→│         ▼                                                                    │
   413→│   ┌───────────────┐                                                         │
   414→│   │ Any FAIL      │──── YES ───▶ Exit 1 (FAIL)                              │
   415→│   │ results?      │                                                         │
   416→│   └───────────────┘                                                         │
   417→│         │ NO                                                                 │
   418→│         ▼                                                                    │
   419→│   ┌───────────────┐                                                         │
   420→│   │ --strict and  │──── YES ───▶ Exit 1 (FAIL)                              │
   421→│   │ any WARN?     │                                                         │
   422→│   └───────────────┘                                                         │
   423→│         │ NO                                                                 │
   424→│         ▼                                                                    │
   425→│   Exit 0 (PASS) ──────────────▶ Safe to deploy!                             │
   426→│                                                                              │
   427→└─────────────────────────────────────────────────────────────────────────────┘
   428→\```
   429→
   430→### CI Pipeline Example
   431→
   432→\```bash
   433→#!/bin/bash
   434→set -e
   435→
   436→echo "=== Syncing variants ==="
   437→npm run variants:check
   438→
   439→echo "=== Checking claims ==="
   440→npm run eval:check
   441→
   442→echo "=== Red team gate ==="
   443→npm run redteam:check --strict
   444→
   445→echo "=== All gates passed! Deploying... ==="
   446→npm run build
   447→\```
   448→
   449→---
   450→
   451→## Complete Workflow Example
   452→
   453→Let's walk through creating `acme-senior-pm` end-to-end:
   454→
   455→### 1. Create
   456→
   457→\```bash
   458→cp content/variants/_template.yaml content/variants/acme-senior-pm.yaml
   459→# Edit the file with your customizations
   460→\```
   461→
   462→### 2. Sync
   463→
   464→\```bash
   465→npm run variants:sync -- --slug acme-senior-pm
   466→\```
   467→\```
   468→✓ acme-senior-pm (created)
   469→\```
   470→
   471→### 3. Evaluate
   472→
   473→\```bash
   474→npm run eval:variant -- --slug acme-senior-pm
   475→\```
   476→\```
   477→✓ acme-senior-pm: 5 claims, 0 verified, 5 unverified
   478→\```
   479→
   480→### 4. Verify Claims
   481→
   482→\```bash
   483→# Open and edit the claims ledger
   484→code capstone/develop/evals/acme-senior-pm.claims.yaml
   485→\```
   486→
   487→For each claim, update `verified.status` to `verified` and add sources.
   488→
   489→### 5. Red Team
   490→
   491→\```bash
   492→npm run redteam:variant -- --slug acme-senior-pm
   493→\```
   494→\```
   495→✓ acme-senior-pm passed
   496→\```
   497→
   498→### 6. Gate Check
   499→
   500→\```bash
   501→npm run eval:check && npm run redteam:check
   502→\```
   503→\```
   504→✓ All variants pass evaluation
   505→✓ All variants pass red team
   506→\```
   507→
   508→### 7. Ship
   509→
   510→\```bash
   511→npm run build
   512→# Deploy to production
   513→\```
   514→
   515→---
   516→
   517→## File Locations Reference
   518→
   519→\```
   520→portfolio/
   521→├── content/
   522→│   └── variants/
   523→│       ├── _template.yaml              ← Start here for new variants
   524→│       ├── acme-senior-pm.yaml         ← Your variant (EDIT THIS)
   525→│       ├── acme-senior-pm.json         ← Generated (DON'T EDIT)
   526→│       └── ...
   527→│
   528→├── content/knowledge/
   529→│   └── achievements/                   ← Source of truth for metrics
   530→│       ├── ankr-15x-revenue.yaml
   531→│       ├── eth-staking-zero-slashing.yaml
   532→│       └── ...
   533→│
   534→├── capstone/develop/
   535→│   ├── evals/
   536→│   │   ├── acme-senior-pm.claims.yaml  ← Claims ledger (VERIFY HERE)
   537→│   │   └── acme-senior-pm.eval.md      ← Human checklist
   538→│   │
   539→│   ├── redteam/
   540→│   │   └── acme-senior-pm.redteam.md   ← Red team report
   541→│   │
   542→│   ├── evaluation.md                   ← Evaluation rubric
   543→│   └── red-teaming.md                  ← Threat model docs
   544→│
   545→└── scripts/
   546→    ├── cli/theme.ts                    ← CLI styling
   547→    ├── sync-variants.ts
   548→    ├── evaluate-variants.ts
   549→    └── redteam.ts
   550→\```
   551→
   552→---
   553→
   554→## CLI Flags Reference
   555→
   556→### All Commands Support
   557→
   558→| Flag | Description |
   559→|------|-------------|
   560→| `--json` | Machine-readable JSON output |
   561→| `--quiet` | Suppress non-essential output |
   562→| `--slug <name>` | Target specific variant |
   563→
   564→### Sync-Specific
   565→
   566→| Flag | Description |
   567→|------|-------------|
   568→| `--check` | Verify mode (exit 1 if drift) |
   569→
   570→### Red Team-Specific
   571→
   572→| Flag | Description |
   573→|------|-------------|
   574→| `--all` | Scan all variants |
   575→| `--check` | Gate mode (exit 1 on FAIL) |
   576→| `--strict` | WARN becomes FAIL |
   577→| `--no-write` | Don't write report file |
   578→
   579→---
   580→
   581→## Troubleshooting
   582→
   583→### "Slug mismatch" Error
   584→
   585→\```
   586→✗ acme-senior-pm error
   587→  Slug mismatch: metadata.slug='acme-pm' but filename implies 'acme-senior-pm'
   588→\```
   589→
   590→**Fix**: Ensure `metadata.slug` in YAML matches the filename exactly.
   591→
   592→### "Variant YAML not found"
   593→
   594→\```
   595→✗ acme-senior-pm error
   596→  Variant YAML not found
   597→\```
   598→
   599→**Fix**: Check the file exists at `content/variants/acme-senior-pm.yaml`
   600→
   601→### Red Team Fails on RT-ACC-CLAIMS
   602→
   603→\```
   604→RT-ACC-CLAIMS: FAIL - Missing/unverified claims
   605→\```
   606→
   607→**Fix**:
   608→1. Run `npm run eval:variant -- --slug <slug>`
   609→2. Open the `.claims.yaml` file
   610→3. Verify each claim and update `verified.status`
   611→
   612→### All Claims Show "unverified"
   613→
   614→The evaluation script finds candidates but doesn't auto-verify. You must:
   615→1. Review each claim's `candidateSources`
   616→2. Manually update `verified.status` to `verified`
   617→3. Add the source path to `verified.sources`
   618→
   619→---
   620→
   621→## Quick Reference Card
   622→
   623→\```
   624→┌─────────────────────────────────────────────────────────────────────────────┐
   625→│                        UNIVERSAL CV CLI QUICK REFERENCE                      │
   626→├─────────────────────────────────────────────────────────────────────────────┤
   627→│                                                                              │
   628→│  CREATE                                                                      │
   629→│    cp content/variants/_template.yaml content/variants/<slug>.yaml           │
   630→│                                                                              │
   631→│  SYNC                                                                        │
   632→│    npm run variants:sync                    # Sync all                       │
   633→│    npm run variants:sync -- --slug <slug>   # Sync one                       │
   634→│    npm run variants:check                   # CI mode                        │
   635→│                                                                              │
   636→│  EVALUATE                                                                    │
   637→│    npm run eval:variant -- --slug <slug>    # Evaluate one                   │
   638→│    npm run eval:all                         # Evaluate all                   │
   639→│    npm run eval:check                       # CI gate                        │
   640→│                                                                              │
   641→│  RED TEAM                                                                    │
   642→│    npm run redteam:variant -- --slug <slug> # Scan one                       │
   643→│    npm run redteam:all                      # Scan all                       │
   644→│    npm run redteam:check                    # CI gate (WARN ok)              │
   645→│    npm run redteam:check -- --strict        # CI gate (WARN = FAIL)          │
   646→│                                                                              │
   647→│  JSON OUTPUT (any command)                                                   │
   648→│    npm run <command> -- --json              # Machine-readable               │
   649→│                                                                              │
   650→└─────────────────────────────────────────────────────────────────────────────┘
   651→\```
   652→
```

Result:

```
1→# Capstone Quality Pipeline: Step-by-Step Workflow
     2→
     3→This guide walks you through the complete quality pipeline for a variant, using `mysten-walrus-senior-pm` as a working example.
     4→
     5→---
     6→
     7→## Quick Reference: File Locations
     8→
     9→| What | Where | Purpose |
    10→|------|-------|---------|
    11→| **Variant YAML** | `content/variants/<slug>.yaml` | Source of truth (edit this) |
    12→| **Variant JSON** | `content/variants/<slug>.json` | Runtime artifact (auto-generated) |
    13→| **Knowledge Base** | `content/knowledge/achievements/*.yaml` | Facts & metrics source |
    14→| **Claims Ledger** | `capstone/develop/evals/<slug>.claims.yaml` | Extracted claims + verification status |
    15→| **Eval Checklist** | `capstone/develop/evals/<slug>.eval.md` | Human-readable checklist |
    16→| **Red Team Report** | `capstone/develop/redteam/<slug>.redteam.md` | Adversarial scan results |
    17→| **Evaluation Rubric** | `capstone/develop/evaluation.md` | How claims are evaluated |
    18→| **Threat Model** | `capstone/develop/red-teaming.md` | Red team check definitions |
    19→
    20→---
    21→
    22→## The Pipeline Flow
    23→
    24→\```
    25→┌─────────────────────────────────────────────────────────────────────────────┐
    26→│  1. SYNC          2. EVALUATE         3. RED TEAM         4. SHIP          │
    27→│                                                                             │
    28→│  YAML → JSON      Extract claims      Adversarial         Deploy if        │
    29→│  (deterministic)  Find sources        scans               gates pass       │
    30→│                   Mark verified                                             │
    31→└─────────────────────────────────────────────────────────────────────────────┘
    32→\```
    33→
    34→---
    35→
    36→## Step 1: Sync Variants
    37→
    38→**Purpose**: Convert YAML (human-editable) to JSON (runtime artifact).
    39→
    40→\```bash
    41→npm run variants:sync
    42→\```
    43→
    44→**What happens**:
    45→- Reads all `content/variants/*.yaml` files
    46→- Validates against Zod schema
    47→- Writes `content/variants/*.json` files
    48→
    49→**Check for drift**:
    50→\```bash
    51→npm run variants:check
    52→\```
    53→Fails if JSON doesn't match YAML (useful in CI).
    54→
    55→**Output**: JSON files in `content/variants/`
    56→
    57→---
    58→
    59→## Step 2: Generate Claims Ledger
    60→
    61→**Purpose**: Extract all metric-like claims and find candidate sources.
    62→
    63→\```bash
    64→npm run eval:variant -- --slug mysten-walrus-senior-pm
    65→\```
    66→
    67→**What happens**:
    68→1. Parses the variant YAML
    69→2. Extracts claims containing metrics (%, $, ×, numbers)
    70→3. Searches knowledge base for matching sources
    71→4. Generates a claims ledger with candidate sources
    72→
    73→**Outputs created**:
    74→- `capstone/develop/evals/mysten-walrus-senior-pm.claims.yaml` - Machine-readable ledger
    75→- `capstone/develop/evals/mysten-walrus-senior-pm.eval.md` - Human checklist
    76→
    77→### Understanding the Claims Ledger
    78→
    79→Open `capstone/develop/evals/<slug>.claims.yaml`:
    80→
    81→\```yaml
    82→claims:
    83→  - id: metric-1080fe1903
    84→    location: overrides.hero.subheadline    # Where in variant
    85→    text: "Senior PM with 8 years..."       # The claim text
    86→    anchors:
    87→      - 8 years                              # Key metric extracted
    88→    candidateSources:
    89→      - path: content/knowledge/achievements/...
    90→        score: 0.09
    91→        matchedAnchors: []
    92→        note: "anchors 0/1 • overlap 60%"
    93→    verified:
    94→      status: unverified                     # YOU EDIT THIS
    95→      sources: []
    96→      notes: ""
    97→\```
    98→
    99→### Verifying Claims
   100→
   101→For each claim, you need to:
   102→
   103→1. **Check candidate sources** - Does a knowledge base file contain this fact?
   104→2. **Update verified status** - Change `unverified` → `verified`
   105→3. **Add source path** - Reference the KB file that proves the claim
   106→4. **Add notes** - Optional context
   107→
   108→**Example: Before**
   109→\```yaml
   110→verified:
   111→  status: unverified
   112→  sources: []
   113→  notes: ""
   114→\```
   115→
   116→**Example: After**
   117→\```yaml
   118→verified:
   119→  status: verified
   120→  sources:
   121→    - content/knowledge/achievements/l2-protocol-integrations.yaml
   122→  notes: "Anchor '7+ L2 integrations' matches KB exactly"
   123→\```
   124→
   125→### If a claim has no source
   126→
   127→Two options:
   128→
   129→1. **Add to knowledge base** - Create/update a file in `content/knowledge/achievements/`
   130→2. **Reword the variant** - Change the claim in `content/variants/<slug>.yaml`
   131→
   132→**Golden Rule**: Fix facts in the knowledge base first, then regenerate.
   133→
   134→---
   135→
   136→## Step 3: Red Team Scan
   137→
   138→**Purpose**: Adversarial checks for security, tone, and accuracy risks.
   139→
   140→\```bash
   141→npm run redteam:variant -- --slug mysten-walrus-senior-pm
   142→\```
   143→
   144→**What happens**: Runs 8 checks against your variant:
   145→
   146→| Check | Severity | What It Catches |
   147→|-------|----------|-----------------|
   148→| `RT-ACC-CLAIMS` | FAIL | Missing/unverified claims ledger |
   149→| `RT-SEC-SECRETS` | FAIL | API keys, tokens in text |
   150→| `RT-SEC-CONFIDENTIAL` | FAIL | NDA/confidential language |
   151→| `RT-TONE-SYCOPHANCY` | WARN | "thrilled", "dream company" |
   152→| `RT-ACC-INFLATION` | WARN | "about 15×" near metrics |
   153→| `RT-INPUT-INJECTION` | WARN | Prompt injection in JD |
   154→| `RT-PRIV-JD` | WARN | Long JD exposed in public JSON |
   155→| `RT-XVAR-CONTAM` | WARN | Mentions other target company |
   156→
   157→**Output**: `capstone/develop/redteam/mysten-walrus-senior-pm.redteam.md`
   158→
   159→### Fixing Red Team Failures
   160→
   161→**RT-ACC-CLAIMS (most common)**:
   162→\```
   163→FAIL: Missing ledger
   164→Fix: npm run eval:variant -- --slug <slug>
   165→     Then verify claims in the .claims.yaml file
   166→\```
   167→
   168→**RT-TONE-SYCOPHANCY**:
   169→\```
   170→WARN: "thrilled", "dream company" detected
   171→Fix: Edit content/variants/<slug>.yaml
   172→     Remove sycophantic language
   173→\```
   174→
   175→**RT-SEC-SECRETS**:
   176→\```
   177→FAIL: API key pattern detected
   178→Fix: Remove the secret from variant YAML immediately
   179→\```
   180→
   181→---
   182→
   183→## Step 4: Gate Check (CI Mode)
   184→
   185→**Purpose**: Pass/fail gate for deployment.
   186→
   187→\```bash
   188→# Check all variants pass evaluation
   189→npm run eval:check
   190→
   191→# Check all variants pass red team (WARN ok)
   192→npm run redteam:check
   193→
   194→# Strict mode (WARN = FAIL)
   195→npm run redteam:check -- --strict
   196→\```
   197→
   198→**Exit codes**:
   199→- `0` = All checks pass
   200→- `1` = At least one failure
   201→
   202→---
   203→
   204→## Complete Example: mysten-walrus-senior-pm
   205→
   206→### 1. Sync
   207→
   208→\```bash
   209→npm run variants:sync
   210→\```
   211→\```
   212→✓ mysten-walrus-senior-pm (in sync)
   213→\```
   214→
   215→### 2. Evaluate
   216→
   217→\```bash
   218→npm run eval:variant -- --slug mysten-walrus-senior-pm
   219→\```
   220→\```
   221→✓ mysten-walrus-senior-pm: 5 claims, 0 verified, 5 unverified
   222→  capstone/develop/evals/mysten-walrus-senior-pm.claims.yaml
   223→\```
   224→
   225→### 3. Verify Claims
   226→
   227→Open `capstone/develop/evals/mysten-walrus-senior-pm.claims.yaml`
   228→
   229→For each claim:
   230→1. Check if `candidateSources` has a good match (score > 0.5)
   231→2. Verify the anchor text matches the KB file
   232→3. Update `verified.status` to `verified`
   233→4. Add the source path
   234→
   235→### 4. Red Team
   236→
   237→\```bash
   238→npm run redteam:variant -- --slug mysten-walrus-senior-pm
   239→\```
   240→\```
   241→✗ mysten-walrus-senior-pm 1 FAIL 0 WARN
   242→\```
   243→
   244→Check `capstone/develop/redteam/mysten-walrus-senior-pm.redteam.md`:
   245→\```
   246→RT-ACC-CLAIMS: FAIL - Missing/unverified claims
   247→\```
   248→
   249→### 5. Fix & Iterate
   250→
   251→Fix unverified claims → Re-run eval → Re-run redteam → Repeat until clean.
   252→
   253→### 6. Final Gate
   254→
   255→\```bash
   256→npm run eval:check && npm run redteam:check
   257→\```
   258→\```
   259→✓ All variants pass
   260→\```
   261→
   262→---
   263→
   264→## Adding New Knowledge Base Entries
   265→
   266→If a claim has no source, add it to the knowledge base:
   267→
   268→\```bash
   269→# Create new achievement file
   270→touch content/knowledge/achievements/my-new-achievement.yaml
   271→\```
   272→
   273→**Template** (`content/knowledge/achievements/*.yaml`):
   274→\```yaml
   275→id: my-new-achievement
   276→type: achievement
   277→title: "Short descriptive title"
   278→company: Company Name
   279→timeframe: "2023-2024"
   280→situation: |
   281→  Brief context (STAR format)
   282→task: |
   283→  What needed to be done
   284→action: |
   285→  What you specifically did
   286→result: |
   287→  Quantified outcomes
   288→metrics:
   289→  - value: "15×"
   290→    label: "revenue increase"
   291→    context: "Year-over-year growth"
   292→tags:
   293→  - web3
   294→  - infrastructure
   295→\```
   296→
   297→After adding, re-run evaluation to pick up the new source.
   298→
   299→---
   300→
   301→## JSON Output for Automation
   302→
   303→All commands support `--json` for machine-readable output:
   304→
   305→\```bash
   306→npm run variants:sync -- --json
   307→npm run eval:variant -- --slug mysten-walrus-senior-pm --json
   308→npm run redteam:all -- --json
   309→\```
   310→
   311→Useful for CI pipelines:
   312→\```bash
   313→npm run redteam:all -- --json | jq '.errors | length'
   314→\```
   315→
   316→---
   317→
   318→## Troubleshooting
   319→
   320→### "Variant YAML not found"
   321→Check the slug matches the filename:
   322→\```bash
   323→ls content/variants/*.yaml
   324→\```
   325→
   326→### "Claims ledger missing"
   327→Run evaluation first:
   328→\```bash
   329→npm run eval:variant -- --slug <slug>
   330→\```
   331→
   332→### "All claims unverified"
   333→You need to manually verify each claim in `.claims.yaml`.
   334→The script finds candidates but doesn't auto-verify.
   335→
   336→### "Red team fails on RT-ACC-CLAIMS"
   337→This means claims exist but aren't verified. Open the `.claims.yaml` and update the `verified` sections.
   338→
   339→---
   340→
   341→## Quick Commands Reference
   342→
   343→\```bash
   344→# Sync all variants
   345→npm run variants:sync
   346→
   347→# Evaluate one variant
   348→npm run eval:variant -- --slug mysten-walrus-senior-pm
   349→
   350→# Evaluate all variants
   351→npm run eval:all
   352→
   353→# Red team one variant
   354→npm run redteam:variant -- --slug mysten-walrus-senior-pm
   355→
   356→# Red team all variants
   357→npm run redteam:all
   358→
   359→# CI gate checks
   360→npm run eval:check
   361→npm run redteam:check
   362→npm run redteam:check -- --strict
   363→\```
   364→
```

Result:

```
/Users/dfotesco/Portfolio/portfolio/src/App.tsx
/Users/dfotesco/Portfolio/portfolio/src/main.tsx
/Users/dfotesco/Portfolio/portfolio/src/types/variant.ts
/Users/dfotesco/Portfolio/portfolio/src/types/portfolio.ts
/Users/dfotesco/Portfolio/portfolio/src/types/blog.ts
/Users/dfotesco/Portfolio/portfolio/src/types/yaml.d.ts
/Users/dfotesco/Portfolio/portfolio/src/context/ThemeContext.tsx
/Users/dfotesco/Portfolio/portfolio/src/context/VariantContext.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/navigation/navigation.test.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/setup.ts
/Users/dfotesco/Portfolio/portfolio/src/tests/blog/blog-ux-features.test.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/blog/blog-navigation.test.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/mobile/mobile.test.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/design-system/theme-toggle.test.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/design-system/components.test.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/design-system/css-variables.test.ts
/Users/dfotesco/Portfolio/portfolio/src/tests/case-study/case-study.test.tsx
/Users/dfotesco/Portfolio/portfolio/src/tests/validation/content-validation.test.ts
/Users/dfotesco/Portfolio/portfolio/src/components/LikeAnalytics.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/AboutSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/FooterSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/CertificationsSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/ExperienceSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/TestimonialsSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/CaseStudiesSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/HeroSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/index.ts
/Users/dfotesco/Portfolio/portfolio/src/components/sections/SocialSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/sections/PassionProjectsSection.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/Blog.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/common/AmbientBackground.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/common/SEO.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/common/Omnibar.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/ThemeToggle.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/Portfolio.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/BlogPostModal.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/case-study/CaseStudyContent.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/case-study/CaseStudyHeader.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/case-study/CaseStudyFooter.tsx
/Users/dfotesco/Portfolio/portfolio/src/components/case-study/CaseStudyLinks.tsx
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Excellent! Now let me look at the actual implementation files:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** Find scripts directory TypeScript files

`find /Users/dfotesco/Portfolio/portfolio -type f -path "*/scripts/*.ts" | head -20`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** List scripts directory

`ls -la /Users/dfotesco/Portfolio/portfolio/scripts/ 2>/dev/null`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** Show npm scripts in package.json

`cat /Users/dfotesco/Portfolio/portfolio/package.json | grep -A 30 '"scripts"'`

Result:

```
total 160
drwxr-xr-x@  9 dfotesco  staff    288 Dec 21 12:20 .
drwxr-xr-x@ 35 dfotesco  staff   1120 Dec 21 12:20 ..
drwxr-xr-x@  3 dfotesco  staff     96 Dec 21 12:20 cli
-rw-r--r--@  1 dfotesco  staff  20697 Dec 21 12:20 evaluate-variants.ts
-rw-r--r--@  1 dfotesco  staff  13736 Dec 18 06:16 generate-cv.ts
-rw-r--r--@  1 dfotesco  staff   2695 Dec 20 11:37 generate-og-images.js
-rw-r--r--@  1 dfotesco  staff  16630 Dec 21 12:20 redteam.ts
-rw-r--r--@  1 dfotesco  staff   6616 Dec 21 12:20 sync-variants.ts
-rw-r--r--@  1 dfotesco  staff   7519 Dec 18 06:16 validate-content.ts
```

Result:

```
/Users/dfotesco/Portfolio/portfolio/scripts/evaluate-variants.ts
/Users/dfotesco/Portfolio/portfolio/scripts/redteam.ts
/Users/dfotesco/Portfolio/portfolio/scripts/sync-variants.ts
/Users/dfotesco/Portfolio/portfolio/scripts/cli/theme.ts
/Users/dfotesco/Portfolio/portfolio/scripts/validate-content.ts
/Users/dfotesco/Portfolio/portfolio/scripts/generate-cv.ts
```

Result:

```
"scripts": {
    "dev": "vite",
    "predev": "npm run variants:sync",
    "build": "tsc -b && vite build",
    "postbuild": "cp dist/index.html dist/404.html",
    "prebuild": "npm run validate && npm run variants:sync",
    "lint": "eslint .",
    "preview": "vite preview",
    "test": "vitest run",
    "test:watch": "vitest",
    "test:design-system": "vitest run --reporter=verbose src/tests/design-system",
    "validate": "tsx scripts/validate-content.ts",
    "generate:cv": "tsx scripts/generate-cv.ts",
    "generate:og": "node scripts/generate-og-images.js",
    "variants:sync": "tsx scripts/sync-variants.ts",
    "variants:check": "tsx scripts/sync-variants.ts --check",
    "eval:variant": "tsx scripts/evaluate-variants.ts",
    "eval:all": "tsx scripts/evaluate-variants.ts --all",
    "eval:check": "tsx scripts/evaluate-variants.ts --check --all",
    "redteam:variant": "tsx scripts/redteam.ts",
    "redteam:all": "tsx scripts/redteam.ts --all",
    "redteam:check": "tsx scripts/redteam.ts --check --all"
  },
  "dependencies": {
    "@types/react-syntax-highlighter": "^15.5.13",
    "framer-motion": "^12.23.26",
    "gray-matter": "^4.0.3",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-helmet-async": "^2.0.5",
    "react-markdown": "^10.1.0",
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Now let me read the key CLI implementation files:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./scripts/sync-variants.ts`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./scripts/evaluate-variants.ts`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./scripts/redteam.ts`

Result:

```
1→#!/usr/bin/env tsx
     2→/**
     3→ * Variant Sync CLI
     4→ *
     5→ * Canonical source: content/variants/*.yaml
     6→ * Runtime artifact:  content/variants/*.json
     7→ *
     8→ * Why this exists:
     9→ * - The website loads variants as JSON via Vite import.meta.glob.
    10→ * - Humans and agents should edit YAML (reviewable).
    11→ * - JSON must be deterministic and kept in sync (no YAML/JSON drift).
    12→ *
    13→ * Usage:
    14→ *   npm run variants:sync
    15→ *   npm run variants:sync -- --slug mysten-walrus-senior-pm
    16→ *   npm run variants:check
    17→ *   npm run variants:sync -- --json
    18→ */
    19→
    20→import { existsSync, readFileSync, readdirSync, writeFileSync } from 'fs';
    21→import { join } from 'path';
    22→import YAML from 'yaml';
    23→import ora from 'ora';
    24→import { VariantSchema } from '../src/lib/schemas.js';
    25→import { theme, HEADER_COMPACT, kv, box } from './cli/theme.js';
    26→
    27→type Args = {
    28→  slug?: string;
    29→  check: boolean;
    30→  quiet: boolean;
    31→  json: boolean;
    32→};
    33→
    34→type SyncResult = {
    35→  slug: string;
    36→  status: 'synced' | 'updated' | 'created' | 'error';
    37→  message?: string;
    38→};
    39→
    40→function parseArgs(): Args {
    41→  const argv = process.argv.slice(2);
    42→  const out: Args = { check: false, quiet: false, json: false };
    43→  for (let i = 0; i < argv.length; i++) {
    44→    const a = argv[i];
    45→    const n = argv[i + 1];
    46→    if (a === '--slug') {
    47→      out.slug = n;
    48→      i++;
    49→    } else if (a === '--check') {
    50→      out.check = true;
    51→    } else if (a === '--quiet') {
    52→      out.quiet = true;
    53→    } else if (a === '--json') {
    54→      out.json = true;
    55→    }
    56→  }
    57→  return out;
    58→}
    59→
    60→function stableJson(obj: unknown): string {
    61→  return JSON.stringify(obj, null, 2) + '\n';
    62→}
    63→
    64→function listVariantYamlFiles(variantsDir: string): string[] {
    65→  return readdirSync(variantsDir)
    66→    .filter(f => f.endsWith('.yaml'))
    67→    .filter(f => !f.startsWith('_'));
    68→}
    69→
    70→function syncOneVariant(variantsDir: string, yamlFile: string, checkOnly: boolean): SyncResult {
    71→  const slugFromFile = yamlFile.replace(/\.yaml$/, '');
    72→  const yamlPath = join(variantsDir, yamlFile);
    73→  const jsonPath = join(variantsDir, `${slugFromFile}.json`);
    74→
    75→  try {
    76→    const raw = readFileSync(yamlPath, 'utf-8');
    77→    const parsed = YAML.parse(raw);
    78→    const validated = VariantSchema.parse(parsed);
    79→
    80→    if (validated.metadata.slug !== slugFromFile) {
    81→      return {
    82→        slug: slugFromFile,
    83→        status: 'error',
    84→        message: `Slug mismatch: metadata.slug='${validated.metadata.slug}' but filename implies '${slugFromFile}'`
    85→      };
    86→    }
    87→
    88→    const nextJson = stableJson(validated);
    89→    const hadJson = existsSync(jsonPath);
    90→    const prevJson = hadJson ? readFileSync(jsonPath, 'utf-8') : '';
    91→
    92→    if (!hadJson) {
    93→      if (checkOnly) {
    94→        return {
    95→          slug: slugFromFile,
    96→          status: 'error',
    97→          message: `Missing JSON artifact. Run: npm run variants:sync`
    98→        };
    99→      }
   100→      writeFileSync(jsonPath, nextJson, 'utf-8');
   101→      return { slug: slugFromFile, status: 'created' };
   102→    }
   103→
   104→    if (prevJson !== nextJson) {
   105→      if (checkOnly) {
   106→        return {
   107→          slug: slugFromFile,
   108→          status: 'error',
   109→          message: `Drift detected. Run: npm run variants:sync`
   110→        };
   111→      }
   112→      writeFileSync(jsonPath, nextJson, 'utf-8');
   113→      return { slug: slugFromFile, status: 'updated' };
   114→    }
   115→
   116→    return { slug: slugFromFile, status: 'synced' };
   117→  } catch (err) {
   118→    return {
   119→      slug: slugFromFile,
   120→      status: 'error',
   121→      message: err instanceof Error ? err.message : String(err)
   122→    };
   123→  }
   124→}
   125→
   126→async function main() {
   127→  const args = parseArgs();
   128→  const variantsDir = join(process.cwd(), 'content', 'variants');
   129→
   130→  // JSON output mode - minimal, machine-readable
   131→  if (args.json) {
   132→    if (!existsSync(variantsDir)) {
   133→      console.log(JSON.stringify({ variants: [], errors: [] }));
   134→      process.exit(0);
   135→    }
   136→
   137→    const allYaml = listVariantYamlFiles(variantsDir);
   138→    const targets = args.slug ? allYaml.filter(f => f === `${args.slug}.yaml`) : allYaml;
   139→    const results = targets.map(f => syncOneVariant(variantsDir, f, args.check));
   140→
   141→    const output = {
   142→      mode: args.check ? 'check' : 'sync',
   143→      variants: results.filter(r => r.status !== 'error'),
   144→      errors: results.filter(r => r.status === 'error')
   145→    };
   146→
   147→    console.log(JSON.stringify(output, null, 2));
   148→    process.exit(output.errors.length > 0 ? 1 : 0);
   149→  }
   150→
   151→  // Interactive output
   152→  if (!args.quiet) {
   153→    console.log(HEADER_COMPACT);
   154→    console.log();
   155→  }
   156→
   157→  if (!existsSync(variantsDir)) {
   158→    if (!args.quiet) {
   159→      console.log(theme.muted('No variants directory found. Nothing to do.'));
   160→    }
   161→    process.exit(0);
   162→  }
   163→
   164→  const allYaml = listVariantYamlFiles(variantsDir);
   165→  const targets = args.slug ? allYaml.filter(f => f === `${args.slug}.yaml`) : allYaml;
   166→
   167→  if (args.slug && targets.length === 0) {
   168→    console.error(`${theme.icons.error} Variant YAML not found: ${theme.bold(args.slug)}`);
   169→    console.error(theme.muted(`  Expected: content/variants/${args.slug}.yaml`));
   170→    process.exit(1);
   171→  }
   172→
   173→  const spinner = ora({
   174→    text: args.check ? 'Checking variants...' : 'Syncing variants...',
   175→    color: 'yellow'
   176→  }).start();
   177→
   178→  const results: SyncResult[] = [];
   179→
   180→  for (const yamlFile of targets) {
   181→    const result = syncOneVariant(variantsDir, yamlFile, args.check);
   182→    results.push(result);
   183→  }
   184→
   185→  spinner.stop();
   186→
   187→  // Display results
   188→  const updated = results.filter(r => r.status === 'updated' || r.status === 'created');
   189→  const synced = results.filter(r => r.status === 'synced');
   190→  const errors = results.filter(r => r.status === 'error');
   191→
   192→  if (!args.quiet) {
   193→    console.log(theme.bold(args.check ? 'Checking variants' : 'Syncing variants'));
   194→    console.log(theme.muted(variantsDir));
   195→    console.log();
   196→
   197→    for (const r of results) {
   198→      if (r.status === 'error') {
   199→        console.log(`${theme.icons.error} ${r.slug} ${theme.error('error')}`);
   200→        if (r.message) console.log(theme.muted(`  ${r.message}`));
   201→      } else if (r.status === 'created') {
   202→        console.log(`${theme.icons.success} ${r.slug} ${theme.success('(created)')}`);
   203→      } else if (r.status === 'updated') {
   204→        console.log(`${theme.icons.success} ${r.slug} ${theme.warning('(updated)')}`);
   205→      } else {
   206→        console.log(`${theme.icons.success} ${r.slug} ${theme.muted('(in sync)')}`);
   207→      }
   208→    }
   209→
   210→    console.log();
   211→    console.log(theme.muted('Summary:'), `${results.length} variant(s), ${updated.length} updated, ${errors.length} errors`);
   212→  }
   213→
   214→  if (errors.length > 0) {
   215→    process.exit(1);
   216→  }
   217→
   218→  process.exit(0);
   219→}
   220→
   221→main().catch((err) => {
   222→  console.error(`${theme.icons.error} ${theme.error('Fatal:')} ${err instanceof Error ? err.message : String(err)}`);
   223→  process.exit(1);
   224→});
   225→
```

Result:

```
1→#!/usr/bin/env tsx
     2→/**
     3→ * Variant Evaluation CLI (Executable Framework)
     4→ *
     5→ * This CLI makes your capstone evaluation framework *operational*.
     6→ *
     7→ * Grounded to this repo:
     8→ * - Variants live in:      content/variants/<slug>.yaml   (canonical, human-editable)
     9→ * - Runtime artifact is:   content/variants/<slug>.json   (what the website loads)
    10→ * - Knowledge base lives:  content/knowledge/**           (source of truth for facts)
    11→ *
    12→ * What this tool produces:
    13→ * - capstone/develop/evals/<slug>.claims.yaml  (machine-checkable "claims ledger")
    14→ * - capstone/develop/evals/<slug>.eval.md      (human checklist + scan summary)
    15→ *
    16→ * The claims ledger is intentionally strict:
    17→ * - It extracts "metric-like" claims (numbers, %, $, ×, +, and quantifiers like "billions", "zero")
    18→ * - Each claim must be VERIFIED against a source file (with anchors)
    19→ * - eval:check will fail if a verified anchor disappears later (regression detection)
    20→ *
    21→ * Usage:
    22→ *   npm run eval:variant -- --slug mysten-walrus-senior-pm
    23→ *   npm run eval:all
    24→ *   npm run eval:check
    25→ *   npm run eval:variant -- --json
    26→ */
    27→
    28→import { existsSync, readFileSync, readdirSync, mkdirSync, writeFileSync } from 'fs';
    29→import { join } from 'path';
    30→import crypto from 'crypto';
    31→import YAML from 'yaml';
    32→import ora from 'ora';
    33→import { VariantSchema } from '../src/lib/schemas.js';
    34→import { theme, HEADER_COMPACT } from './cli/theme.js';
    35→
    36→type VerifyArg = { id: string; sourcePath: string };
    37→
    38→type Args = {
    39→  slug?: string;
    40→  all: boolean;
    41→  check: boolean;
    42→  noWrite: boolean;
    43→  json: boolean;
    44→  verify: VerifyArg[];
    45→};
    46→
    47→type CandidateSource = {
    48→  path: string;
    49→  score: number;
    50→  matchedAnchors: string[];
    51→  note?: string;
    52→};
    53→
    54→type VerifiedSource = {
    55→  path: string;
    56→  anchors: string[];
    57→};
    58→
    59→type ClaimEntry = {
    60→  id: string;
    61→  location: string;
    62→  text: string;
    63→  anchors: string[];
    64→  candidateSources: CandidateSource[];
    65→  verified: {
    66→    status: 'unverified' | 'verified';
    67→    sources: VerifiedSource[];
    68→    notes?: string;
    69→  };
    70→};
    71→
    72→type ClaimsLedger = {
    73→  version: 1;
    74→  variant: {
    75→    slug: string;
    76→    variantFile: string;
    77→    contentHash: string;
    78→    evaluatedAt: string;
    79→  };
    80→  claims: ClaimEntry[];
    81→};
    82→
    83→type EvalResult = {
    84→  slug: string;
    85→  status: 'ok' | 'error';
    86→  claims: number;
    87→  verified: number;
    88→  unverified: number;
    89→  message?: string;
    90→};
    91→
    92→function parseArgs(): Args {
    93→  const argv = process.argv.slice(2);
    94→  const out: Args = { all: false, check: false, noWrite: false, json: false, verify: [] };
    95→
    96→  for (let i = 0; i < argv.length; i++) {
    97→    const a = argv[i];
    98→    const n = argv[i + 1];
    99→    if (a === '--slug') {
   100→      out.slug = n;
   101→      i++;
   102→    } else if (a === '--all') {
   103→      out.all = true;
   104→    } else if (a === '--check') {
   105→      out.check = true;
   106→    } else if (a === '--no-write') {
   107→      out.noWrite = true;
   108→    } else if (a === '--json') {
   109→      out.json = true;
   110→    } else if (a === '--verify') {
   111→      const v = n || '';
   112→      const [id, sourcePath] = v.split('=');
   113→      if (!id || !sourcePath) {
   114→        throw new Error(`Invalid --verify value '${v}'. Expected: <claimId>=<sourcePath>`);
   115→      }
   116→      out.verify.push({ id, sourcePath });
   117→      i++;
   118→    }
   119→  }
   120→
   121→  // Default behavior:
   122→  // - eval:check (when called without slug) should check all variants.
   123→  if (out.check && !out.slug) out.all = true;
   124→
   125→  if (!out.slug && !out.all) {
   126→    throw new Error('Provide --slug <slug> or --all');
   127→  }
   128→  if (out.slug && out.all) {
   129→    throw new Error('Choose either --slug or --all, not both.');
   130→  }
   131→
   132→  return out;
   133→}
   134→
   135→function listVariantSlugs(): string[] {
   136→  const variantsDir = join(process.cwd(), 'content', 'variants');
   137→  if (!existsSync(variantsDir)) return [];
   138→  return readdirSync(variantsDir)
   139→    .filter(f => f.endsWith('.yaml'))
   140→    .filter(f => !f.startsWith('_'))
   141→    .map(f => f.replace(/\.yaml$/, ''));
   142→}
   143→
   144→function sha256(input: string): string {
   145→  return crypto.createHash('sha256').update(input).digest('hex');
   146→}
   147→
   148→function stableJson(obj: unknown): string {
   149→  return JSON.stringify(obj, null, 2) + '\n';
   150→}
   151→
   152→function computeVariantContentHash(validatedVariant: any): string {
   153→  const payload = stableJson({
   154→    slug: validatedVariant.metadata.slug,
   155→    company: validatedVariant.metadata.company,
   156→    role: validatedVariant.metadata.role,
   157→    overrides: validatedVariant.overrides,
   158→    relevance: validatedVariant.relevance ?? null
   159→  });
   160→  return sha256(payload);
   161→}
   162→
   163→function readVariantYaml(slug: string): { yamlPath: string; raw: string; validated: any } {
   164→  const yamlPath = join(process.cwd(), 'content', 'variants', `${slug}.yaml`);
   165→  if (!existsSync(yamlPath)) {
   166→    throw new Error(`Variant YAML not found: ${yamlPath}`);
   167→  }
   168→  const raw = readFileSync(yamlPath, 'utf-8');
   169→  const parsed = YAML.parse(raw);
   170→  const validated = VariantSchema.parse(parsed);
   171→  return { yamlPath, raw, validated };
   172→}
   173→
   174→function readVariantJsonIfExists(slug: string): { jsonPath: string; raw: string } | null {
   175→  const jsonPath = join(process.cwd(), 'content', 'variants', `${slug}.json`);
   176→  if (!existsSync(jsonPath)) return null;
   177→  return { jsonPath, raw: readFileSync(jsonPath, 'utf-8') };
   178→}
   179→
   180→function collectStrings(value: any, path: string, out: Array<{ location: string; text: string }>) {
   181→  if (value === null || value === undefined) return;
   182→
   183→  if (typeof value === 'string') {
   184→    const t = value.trim();
   185→    if (t) out.push({ location: path, text: t });
   186→    return;
   187→  }
   188→
   189→  if (Array.isArray(value)) {
   190→    value.forEach((v, i) => collectStrings(v, `${path}[${i}]`, out));
   191→    return;
   192→  }
   193→
   194→  if (typeof value === 'object') {
   195→    for (const [k, v] of Object.entries(value)) {
   196→      collectStrings(v, `${path}.${k}`, out);
   197→    }
   198→  }
   199→}
   200→
   201→function splitSentences(text: string): string[] {
   202→  const normalized = text.replace(/\s+/g, ' ').trim();
   203→  if (!normalized) return [];
   204→  return normalized
   205→    .split(/(?:\.\s+|\?\s+|!\s+|\n+)/)
   206→    .map(s => s.trim())
   207→    .filter(Boolean);
   208→}
   209→
   210→const metricWordRe = /\b(zero|billions?|millions?|thousands?|hundreds?|dozens?)\b/gi;
   211→
   212→function extractAnchors(sentence: string): string[] {
   213→  const anchors = new Set<string>();
   214→
   215→  const patterns: RegExp[] = [
   216→    /\$[0-9][0-9.,]*(?:\s?[KMB])?\+?/g,
   217→    /\b[0-9][0-9.,]*\s?%/g,
   218→    /\b[0-9][0-9.,]*\s?[x×]\b/gi,
   219→    /\b[0-9]+\+/g,
   220→    /\b[0-9][0-9.,]*\s?(?:weeks?|months?|years?|days?)\b/gi,
   221→    /\b[0-9][0-9.,]*\s?(?:K|M|B)\b/g
   222→  ];
   223→
   224→  for (const re of patterns) {
   225→    const matches = sentence.match(re);
   226→    matches?.forEach(m => anchors.add(m.trim()));
   227→  }
   228→
   229→  const quant = sentence.match(metricWordRe);
   230→  quant?.forEach(q => anchors.add(q.trim()));
   231→
   232→  const parens = [...sentence.matchAll(/\(([A-Za-z0-9][^)]{0,80})\)/g)].map(m => m[1]);
   233→  for (const p of parens) {
   234→    const trimmed = p.trim();
   235→    if (trimmed.includes(',') && /[A-Z]/.test(trimmed)) {
   236→      anchors.add(trimmed);
   237→    }
   238→  }
   239→
   240→  return [...anchors];
   241→}
   242→
   243→function hasMetricSignal(sentence: string): boolean {
   244→  return /\d/.test(sentence) || /[%$×]/.test(sentence) || metricWordRe.test(sentence);
   245→}
   246→
   247→function makeClaimId(location: string, sentence: string): string {
   248→  const h = crypto.createHash('sha1').update(`${location}|${sentence}`).digest('hex');
   249→  return `metric-${h.slice(0, 10)}`;
   250→}
   251→
   252→function tokenize(text: string): string[] {
   253→  return text
   254→    .toLowerCase()
   255→    .replace(/[^a-z0-9\s]/g, ' ')
   256→    .split(/\s+/)
   257→    .map(s => s.trim())
   258→    .filter(s => s.length >= 4)
   259→    .filter(s => !['this', 'that', 'with', 'from', 'were', 'have', 'your', 'they', 'been', 'into', 'over', 'more', 'most', 'than', 'them'].includes(s));
   260→}
   261→
   262→type SourceDoc = {
   263→  path: string;
   264→  raw: string;
   265→  tokens: Set<string>;
   266→};
   267→
   268→function loadKnowledgeSources(): SourceDoc[] {
   269→  const roots: string[] = [
   270→    join(process.cwd(), 'content', 'knowledge', 'achievements'),
   271→    join(process.cwd(), 'content', 'knowledge', 'stories')
   272→  ];
   273→
   274→  const files: string[] = [];
   275→  for (const r of roots) {
   276→    if (!existsSync(r)) continue;
   277→    for (const f of readdirSync(r)) {
   278→      if (f.endsWith('.yaml')) files.push(join(r, f));
   279→    }
   280→  }
   281→
   282→  const exp = join(process.cwd(), 'content', 'experience', 'index.yaml');
   283→  if (existsSync(exp)) files.push(exp);
   284→
   285→  return files.map(p => {
   286→    const raw = readFileSync(p, 'utf-8');
   287→    return { path: p.replace(process.cwd() + '/', ''), raw, tokens: new Set(tokenize(raw)) };
   288→  });
   289→}
   290→
   291→function candidateSourcesForClaim(claim: { anchors: string[]; text: string }, sources: SourceDoc[]): CandidateSource[] {
   292→  const claimTokens = new Set(tokenize(claim.text));
   293→  const claimTokenList = [...claimTokens];
   294→
   295→  const scored: CandidateSource[] = [];
   296→
   297→  for (const src of sources) {
   298→    const matchedAnchors = claim.anchors.filter(a => src.raw.includes(a));
   299→    const anchorScore = matchedAnchors.length / Math.max(1, claim.anchors.length);
   300→
   301→    let overlapScore = 0;
   302→    if (claimTokenList.length > 0) {
   303→      const hit = claimTokenList.filter(t => src.tokens.has(t)).length;
   304→      overlapScore = hit / claimTokenList.length;
   305→    }
   306→
   307→    const score = Math.min(1, anchorScore + 0.15 * overlapScore);
   308→
   309→    if (matchedAnchors.length > 0 || overlapScore >= 0.25) {
   310→      scored.push({
   311→        path: src.path,
   312→        score: Number(score.toFixed(3)),
   313→        matchedAnchors,
   314→        note: `anchors ${matchedAnchors.length}/${Math.max(1, claim.anchors.length)} • overlap ${(overlapScore * 100).toFixed(0)}%`
   315→      });
   316→    }
   317→  }
   318→
   319→  return scored.sort((a, b) => b.score - a.score).slice(0, 5);
   320→}
   321→
   322→function ensureDir(dir: string) {
   323→  if (!existsSync(dir)) mkdirSync(dir, { recursive: true });
   324→}
   325→
   326→function readLedgerIfExists(ledgerPath: string): ClaimsLedger | null {
   327→  if (!existsSync(ledgerPath)) return null;
   328→  const raw = readFileSync(ledgerPath, 'utf-8');
   329→  const parsed = YAML.parse(raw) as ClaimsLedger;
   330→  return parsed ?? null;
   331→}
   332→
   333→function writeLedger(ledgerPath: string, ledger: ClaimsLedger) {
   334→  const yaml = YAML.stringify(ledger, { lineWidth: 120 });
   335→  writeFileSync(ledgerPath, yaml, 'utf-8');
   336→}
   337→
   338→function writeEvalMd(mdPath: string, slug: string, ledger: ClaimsLedger, notes: string[] = []) {
   339→  const total = ledger.claims.length;
   340→  const verified = ledger.claims.filter(c => c.verified.status === 'verified').length;
   341→  const unverified = total - verified;
   342→
   343→  const lines: string[] = [];
   344→  lines.push(`# Variant Evaluation`);
   345→  lines.push('');
   346→  lines.push(`- Variant: \`${slug}\``);
   347→  lines.push(`- Ledger: \`capstone/develop/evals/${slug}.claims.yaml\``);
   348→  lines.push(`- Evaluated At: ${ledger.variant.evaluatedAt}`);
   349→  lines.push(`- Content Hash: \`${ledger.variant.contentHash.slice(0, 12)}…\``);
   350→  lines.push('');
   351→  lines.push(`## Automated Summary`);
   352→  lines.push('');
   353→  lines.push(`- Claims detected: **${total}**`);
   354→  lines.push(`- Verified: **${verified}**`);
   355→  lines.push(`- Unverified: **${unverified}**`);
   356→  if (notes.length) {
   357→    lines.push('');
   358→    lines.push(`### Notes`);
   359→    for (const n of notes) lines.push(`- ${n}`);
   360→  }
   361→  lines.push('');
   362→  lines.push(`## Claims`);
   363→  lines.push('');
   364→  lines.push(`| Status | Claim | Location | Top candidate source |`);
   365→  lines.push(`|---|---|---|---|`);
   366→  for (const c of ledger.claims) {
   367→    const status = c.verified.status === 'verified' ? '✅ verified' : '⚠️ unverified';
   368→    const top = c.candidateSources[0]?.path ?? '';
   369→    const claimShort = c.text.length > 120 ? c.text.slice(0, 117) + '…' : c.text;
   370→    lines.push(`| ${status} | ${escapeMdInline(claimShort)} | \`${c.location}\` | \`${top}\` |`);
   371→  }
   372→  lines.push('');
   373→  lines.push(`## Human Checklist (Capstone Rubric)`);
   374→  lines.push('');
   375→  lines.push(`Use \`capstone/develop/evaluation.md\` as the rubric. Fill in scores here as you review:`);
   376→  lines.push('');
   377→  lines.push(`- Accuracy: ___ / 5`);
   378→  lines.push(`- Relevance: ___ / 5`);
   379→  lines.push(`- Tone: ___ / 5`);
   380→  lines.push(`- Safety: ___ / 5`);
   381→  lines.push('');
   382→  lines.push(`### Gate`);
   383→  lines.push('');
   384→  lines.push(`- To pass \`npm run eval:check\`: every claim must be **verified** in the claims ledger, and every verified source must still contain its anchors.`);
   385→
   386→  writeFileSync(mdPath, lines.join('\n') + '\n', 'utf-8');
   387→}
   388→
   389→function escapeMdInline(s: string): string {
   390→  return s.replace(/\|/g, '\\|').replace(/\n/g, ' ');
   391→}
   392→
   393→function applyVerifyWrites(ledger: ClaimsLedger, verifyArgs: VerifyArg[]) {
   394→  if (verifyArgs.length === 0) return;
   395→
   396→  const byId = new Map(ledger.claims.map(c => [c.id, c]));
   397→  for (const v of verifyArgs) {
   398→    const claim = byId.get(v.id);
   399→    if (!claim) throw new Error(`--verify references unknown claim id: ${v.id}`);
   400→
   401→    const full = join(process.cwd(), v.sourcePath);
   402→    if (!existsSync(full)) throw new Error(`--verify source path not found: ${v.sourcePath}`);
   403→
   404→    claim.verified.status = 'verified';
   405→    const exists = claim.verified.sources.some(s => s.path === v.sourcePath);
   406→    if (!exists) {
   407→      claim.verified.sources.push({ path: v.sourcePath, anchors: claim.anchors });
   408→    }
   409→  }
   410→}
   411→
   412→function checkLedgerStrict(slug: string, ledgerPath: string, ledger: ClaimsLedger, currentHash: string): string[] {
   413→  const errors: string[] = [];
   414→
   415→  if (ledger.variant.contentHash !== currentHash) {
   416→    errors.push(`Ledger hash mismatch. Re-run: npm run eval:variant -- --slug ${slug}`);
   417→  }
   418→
   419→  for (const claim of ledger.claims) {
   420→    if (claim.verified.status !== 'verified') {
   421→      errors.push(`Unverified claim: ${claim.id} (${claim.location})`);
   422→      continue;
   423→    }
   424→    for (const src of claim.verified.sources) {
   425→      const full = join(process.cwd(), src.path);
   426→      if (!existsSync(full)) {
   427→        errors.push(`Missing source file for ${claim.id}: ${src.path}`);
   428→        continue;
   429→      }
   430→      const raw = readFileSync(full, 'utf-8');
   431→      for (const a of src.anchors) {
   432→        if (!raw.includes(a)) {
   433→          errors.push(`Anchor missing for ${claim.id}: '${a}' not found in ${src.path}`);
   434→        }
   435→      }
   436→    }
   437→  }
   438→
   439→  return errors;
   440→}
   441→
   442→function buildLedger(slug: string): { ledger: ClaimsLedger; ledgerPath: string; mdPath: string; notes: string[] } {
   443→  const { yamlPath, validated } = readVariantYaml(slug);
   444→
   445→  const json = readVariantJsonIfExists(slug);
   446→  const nextJson = stableJson(validated);
   447→  const notes: string[] = [];
   448→  if (!json) {
   449→    notes.push('Variant JSON is missing. Run `npm run variants:sync`.');
   450→  } else if (json.raw !== nextJson) {
   451→    notes.push('Variant YAML and JSON differ. Run `npm run variants:sync` to realign runtime artifacts.');
   452→  }
   453→
   454→  const contentHash = computeVariantContentHash(validated);
   455→
   456→  const snippets: Array<{ location: string; text: string }> = [];
   457→  collectStrings(validated.overrides, 'overrides', snippets);
   458→
   459→  const claims: ClaimEntry[] = [];
   460→  const seen = new Set<string>();
   461→
   462→  const sources = loadKnowledgeSources();
   463→
   464→  for (const snip of snippets) {
   465→    const sentences = splitSentences(snip.text);
   466→
   467→    for (const s of sentences) {
   468→      if (!hasMetricSignal(s)) continue;
   469→
   470→      const anchors = extractAnchors(s);
   471→      if (anchors.length === 0) continue;
   472→
   473→      const id = makeClaimId(snip.location, s);
   474→      if (seen.has(id)) continue;
   475→      seen.add(id);
   476→
   477→      const cands = candidateSourcesForClaim({ anchors, text: s }, sources);
   478→
   479→      claims.push({
   480→        id,
   481→        location: snip.location,
   482→        text: s,
   483→        anchors,
   484→        candidateSources: cands,
   485→        verified: {
   486→          status: 'unverified',
   487→          sources: [],
   488→          notes: ''
   489→        }
   490→      });
   491→    }
   492→  }
   493→
   494→  const evalDir = join(process.cwd(), 'capstone', 'develop', 'evals');
   495→  ensureDir(evalDir);
   496→  const ledgerPath = join(evalDir, `${slug}.claims.yaml`);
   497→  const mdPath = join(evalDir, `${slug}.eval.md`);
   498→
   499→  const existing = readLedgerIfExists(ledgerPath);
   500→  if (existing?.claims?.length) {
   501→    const prevById = new Map(existing.claims.map(c => [c.id, c]));
   502→    for (const c of claims) {
   503→      const prev = prevById.get(c.id);
   504→      if (prev?.verified) {
   505→        c.verified = prev.verified;
   506→      }
   507→    }
   508→  }
   509→
   510→  const ledger: ClaimsLedger = {
   511→    version: 1,
   512→    variant: {
   513→      slug,
   514→      variantFile: yamlPath.replace(process.cwd() + '/', ''),
   515→      contentHash,
   516→      evaluatedAt: new Date().toISOString()
   517→    },
   518→    claims
   519→  };
   520→
   521→  return { ledger, ledgerPath, mdPath, notes };
   522→}
   523→
   524→async function evalOne(slug: string, args: Args): Promise<EvalResult> {
   525→  try {
   526→    const { ledger, ledgerPath, mdPath, notes } = buildLedger(slug);
   527→
   528→    applyVerifyWrites(ledger, args.verify);
   529→
   530→    if (args.check) {
   531→      if (!existsSync(ledgerPath)) {
   532→        return {
   533→          slug,
   534→          status: 'error',
   535→          claims: 0,
   536→          verified: 0,
   537→          unverified: 0,
   538→          message: `Missing claims ledger. Run: npm run eval:variant -- --slug ${slug}`
   539→        };
   540→      }
   541→      const currentHash = ledger.variant.contentHash;
   542→      const onDisk = readLedgerIfExists(ledgerPath);
   543→      if (!onDisk) {
   544→        return {
   545→          slug,
   546→          status: 'error',
   547→          claims: 0,
   548→          verified: 0,
   549→          unverified: 0,
   550→          message: 'Missing claims ledger'
   551→        };
   552→      }
   553→      const errors = checkLedgerStrict(slug, ledgerPath, onDisk, currentHash);
   554→      if (errors.length > 0) {
   555→        return {
   556→          slug,
   557→          status: 'error',
   558→          claims: onDisk.claims.length,
   559→          verified: onDisk.claims.filter(c => c.verified.status === 'verified').length,
   560→          unverified: onDisk.claims.filter(c => c.verified.status !== 'verified').length,
   561→          message: errors.join('; ')
   562→        };
   563→      }
   564→      return {
   565→        slug,
   566→        status: 'ok',
   567→        claims: onDisk.claims.length,
   568→        verified: onDisk.claims.filter(c => c.verified.status === 'verified').length,
   569→        unverified: onDisk.claims.filter(c => c.verified.status !== 'verified').length
   570→      };
   571→    }
   572→
   573→    if (!args.noWrite) {
   574→      writeLedger(ledgerPath, ledger);
   575→      writeEvalMd(mdPath, slug, ledger, notes);
   576→    }
   577→
   578→    const total = ledger.claims.length;
   579→    const verified = ledger.claims.filter(c => c.verified.status === 'verified').length;
   580→    const unverified = total - verified;
   581→
   582→    return { slug, status: 'ok', claims: total, verified, unverified };
   583→  } catch (err) {
   584→    return {
   585→      slug,
   586→      status: 'error',
   587→      claims: 0,
   588→      verified: 0,
   589→      unverified: 0,
   590→      message: err instanceof Error ? err.message : String(err)
   591→    };
   592→  }
   593→}
   594→
   595→async function main() {
   596→  const args = parseArgs();
   597→
   598→  const slugs = args.all ? listVariantSlugs() : [args.slug!];
   599→  if (slugs.length === 0) {
   600→    if (args.json) {
   601→      console.log(JSON.stringify({ results: [] }));
   602→    } else {
   603→      console.log(theme.muted('No variants found. Nothing to evaluate.'));
   604→    }
   605→    process.exit(0);
   606→  }
   607→
   608→  // JSON output mode
   609→  if (args.json) {
   610→    const results: EvalResult[] = [];
   611→    for (const slug of slugs) {
   612→      results.push(await evalOne(slug, args));
   613→    }
   614→    const output = {
   615→      mode: args.check ? 'check' : 'eval',
   616→      results,
   617→      errors: results.filter(r => r.status === 'error')
   618→    };
   619→    console.log(JSON.stringify(output, null, 2));
   620→    process.exit(output.errors.length > 0 ? 1 : 0);
   621→  }
   622→
   623→  // Interactive output
   624→  console.log(HEADER_COMPACT);
   625→  console.log();
   626→
   627→  const spinner = ora({
   628→    text: args.check ? 'Checking claims ledgers...' : 'Evaluating variants...',
   629→    color: 'yellow'
   630→  }).start();
   631→
   632→  const results: EvalResult[] = [];
   633→  for (const slug of slugs) {
   634→    results.push(await evalOne(slug, args));
   635→  }
   636→
   637→  spinner.stop();
   638→
   639→  console.log(theme.bold(args.check ? 'Checking variants' : 'Evaluating variants'));
   640→  console.log(theme.muted(`${slugs.length} variant(s)`));
   641→  console.log();
   642→
   643→  for (const r of results) {
   644→    if (r.status === 'error') {
   645→      console.log(`${theme.icons.error} ${r.slug} ${theme.error('failed')}`);
   646→      if (r.message) console.log(theme.muted(`  ${r.message}`));
   647→    } else {
   648→      const statusText = r.unverified > 0
   649→        ? theme.warning(`${r.verified}/${r.claims} verified`)
   650→        : theme.success(`${r.verified}/${r.claims} verified`);
   651→      console.log(`${theme.icons.success} ${r.slug}: ${statusText}`);
   652→      if (!args.check) {
   653→        console.log(theme.muted(`  Ledger: capstone/develop/evals/${r.slug}.claims.yaml`));
   654→      }
   655→    }
   656→  }
   657→
   658→  const errors = results.filter(r => r.status === 'error');
   659→  if (errors.length > 0) {
   660→    console.log();
   661→    console.log(`${theme.icons.error} ${theme.error(`${errors.length} variant(s) failed`)}`);
   662→    process.exit(1);
   663→  }
   664→
   665→  console.log();
   666→  const totalUnverified = results.reduce((acc, r) => acc + r.unverified, 0);
   667→  if (totalUnverified > 0) {
   668→    console.log(theme.warning(`${theme.icons.warning} ${totalUnverified} unverified claim(s) remaining`));
   669→  } else {
   670→    console.log(theme.success(`${theme.icons.success} All claims verified`));
   671→  }
   672→}
   673→
   674→main().catch((err) => {
   675→  console.error(`${theme.icons.error} ${theme.error('Fatal:')} ${err instanceof Error ? err.message : String(err)}`);
   676→  process.exit(1);
   677→});
   678→
```

Result:

```
1→#!/usr/bin/env tsx
     2→/**
     3→ * Red Team Harness CLI (Executable)
     4→ *
     5→ * Turns capstone/develop/red-teaming.md into repeatable scans + a per-variant report.
     6→ *
     7→ * Grounded to this repo:
     8→ * - We red-team the *actual shipped artifacts*: content/variants/<slug>.yaml (canonical)
     9→ * - We enforce traceability via the claims ledger: capstone/develop/evals/<slug>.claims.yaml
    10→ *
    11→ * What it produces:
    12→ * - capstone/develop/redteam/<slug>.redteam.md
    13→ *
    14→ * Usage:
    15→ *   npm run redteam:variant -- --slug mysten-walrus-senior-pm
    16→ *   npm run redteam:all
    17→ *   npm run redteam:check
    18→ *   npm run redteam:check -- --strict   # WARN becomes FAIL
    19→ */
    20→
    21→import { existsSync, readFileSync, readdirSync, mkdirSync, writeFileSync } from 'fs';
    22→import { join } from 'path';
    23→import YAML from 'yaml';
    24→import ora from 'ora';
    25→import { VariantSchema } from '../src/lib/schemas.js';
    26→import { theme, HEADER_COMPACT, kv } from './cli/theme.js';
    27→
    28→type Args = {
    29→  slug?: string;
    30→  all: boolean;
    31→  check: boolean;
    32→  strict: boolean;
    33→  noWrite: boolean;
    34→  quiet: boolean;
    35→  json: boolean;
    36→};
    37→
    38→type RedteamResult = {
    39→  slug: string;
    40→  status: 'pass' | 'warn' | 'fail' | 'error';
    41→  fails: number;
    42→  warns: number;
    43→  reportPath?: string;
    44→  message?: string;
    45→  findings?: Finding[];
    46→};
    47→
    48→type Finding = {
    49→  id: string;
    50→  title: string;
    51→  severity: 'PASS' | 'WARN' | 'FAIL';
    52→  details?: string[];
    53→};
    54→
    55→function parseArgs(): Args {
    56→  const argv = process.argv.slice(2);
    57→  const out: Args = { all: false, check: false, strict: false, noWrite: false, quiet: false, json: false };
    58→
    59→  for (let i = 0; i < argv.length; i++) {
    60→    const a = argv[i];
    61→    const n = argv[i + 1];
    62→    if (a === '--slug') {
    63→      out.slug = n;
    64→      i++;
    65→    } else if (a === '--all') {
    66→      out.all = true;
    67→    } else if (a === '--check') {
    68→      out.check = true;
    69→    } else if (a === '--strict') {
    70→      out.strict = true;
    71→    } else if (a === '--no-write') {
    72→      out.noWrite = true;
    73→    } else if (a === '--quiet') {
    74→      out.quiet = true;
    75→    } else if (a === '--json') {
    76→      out.json = true;
    77→    }
    78→  }
    79→
    80→  // Default: redteam:check checks all variants.
    81→  if (out.check && !out.slug) out.all = true;
    82→
    83→  if (!out.slug && !out.all) {
    84→    throw new Error('Provide --slug <slug> or --all');
    85→  }
    86→  if (out.slug && out.all) {
    87→    throw new Error('Choose either --slug or --all, not both.');
    88→  }
    89→
    90→  return out;
    91→}
    92→
    93→function listVariantSlugs(): string[] {
    94→  const variantsDir = join(process.cwd(), 'content', 'variants');
    95→  if (!existsSync(variantsDir)) return [];
    96→  return readdirSync(variantsDir)
    97→    .filter(f => f.endsWith('.yaml'))
    98→    .filter(f => !f.startsWith('_'))
    99→    .map(f => f.replace(/\.yaml$/, ''));
   100→}
   101→
   102→function ensureDir(dir: string) {
   103→  if (!existsSync(dir)) mkdirSync(dir, { recursive: true });
   104→}
   105→
   106→function readVariantYaml(slug: string): { raw: string; validated: any } {
   107→  const yamlPath = join(process.cwd(), 'content', 'variants', `${slug}.yaml`);
   108→  if (!existsSync(yamlPath)) throw new Error(`Variant YAML not found: ${yamlPath}`);
   109→  const raw = readFileSync(yamlPath, 'utf-8');
   110→  const parsed = YAML.parse(raw);
   111→  const validated = VariantSchema.parse(parsed);
   112→  return { raw, validated };
   113→}
   114→
   115→function collectStrings(value: any, out: string[]) {
   116→  if (value === null || value === undefined) return;
   117→
   118→  if (typeof value === 'string') {
   119→    const t = value.trim();
   120→    if (t) out.push(t);
   121→    return;
   122→  }
   123→
   124→  if (Array.isArray(value)) {
   125→    value.forEach(v => collectStrings(v, out));
   126→    return;
   127→  }
   128→
   129→  if (typeof value === 'object') {
   130→    for (const v of Object.values(value)) collectStrings(v, out);
   131→  }
   132→}
   133→
   134→function loadClaimsLedger(slug: string): any | null {
   135→  const p = join(process.cwd(), 'capstone', 'develop', 'evals', `${slug}.claims.yaml`);
   136→  if (!existsSync(p)) return null;
   137→  const raw = readFileSync(p, 'utf-8');
   138→  return YAML.parse(raw);
   139→}
   140→
   141→// ---- Checks ----
   142→
   143→const secretPatterns: Array<{ name: string; re: RegExp }> = [
   144→  { name: 'OpenAI key (sk-...)', re: /\bsk-[A-Za-z0-9]{20,}\b/g },
   145→  { name: 'GitHub token (ghp_...)', re: /\bghp_[A-Za-z0-9]{30,}\b/g },
   146→  { name: 'GitHub fine-grained (github_pat_...)', re: /\bgithub_pat_[A-Za-z0-9_]{20,}\b/g },
   147→  { name: 'Anthropic key (sk-ant-...)', re: /\bsk-ant-[A-Za-z0-9\-_]{20,}\b/g },
   148→  { name: 'AWS access key (AKIA...)', re: /\bAKIA[0-9A-Z]{16}\b/g },
   149→  { name: 'Google API key (AIza...)', re: /\bAIza[0-9A-Za-z\-_]{35}\b/g },
   150→  { name: 'Private key header', re: /-----BEGIN (?:RSA |EC |OPENSSH )?PRIVATE KEY-----/g }
   151→];
   152→
   153→const confidentialRe = /\b(confidential|nda|non[-\s]?disclosure|proprietary|internal\s+only|do not share|not public)\b/gi;
   154→
   155→const sycophancyRe = /\b(thrilled|honored|excited to join|dream company|long admired|inspired by|your amazing|industry[-\s]?leading|revolutionary approach)\b/gi;
   156→
   157→const injectionRe = /\b(ignore previous|system prompt|developer message|you are (?:chatgpt|claude)|do not obey|jailbreak|prompt injection|override instructions)\b/gi;
   158→
   159→const approxRe = /\b(about|around|roughly|nearly|approx(?:\.|imately)?|~)\b/gi;
   160→const metricRe = /(\$[0-9][0-9.,]*(?:\s?[KMB])?\+?|\b[0-9][0-9.,]*\s?%|\b[0-9]+\+|\b[0-9][0-9.,]*\s?[x×]\b)/gi;
   161→
   162→function scanSecrets(text: string): Finding {
   163→  const hits: string[] = [];
   164→  for (const p of secretPatterns) {
   165→    const m = text.match(p.re);
   166→    if (m && m.length) hits.push(`${p.name}: ${m.slice(0, 3).join(', ')}${m.length > 3 ? '…' : ''}`);
   167→  }
   168→  return hits.length
   169→    ? { id: 'RT-SEC-SECRETS', title: 'Secrets / tokens accidentally committed', severity: 'FAIL', details: hits }
   170→    : { id: 'RT-SEC-SECRETS', title: 'Secrets / tokens accidentally committed', severity: 'PASS' };
   171→}
   172→
   173→function scanConfidential(text: string): Finding {
   174→  const m = text.match(confidentialRe);
   175→  return m && m.length
   176→    ? { id: 'RT-SEC-CONFIDENTIAL', title: 'Confidential / NDA language present', severity: 'FAIL', details: unique(m).slice(0, 10) }
   177→    : { id: 'RT-SEC-CONFIDENTIAL', title: 'Confidential / NDA language present', severity: 'PASS' };
   178→}
   179→
   180→function scanSycophancy(text: string): Finding {
   181→  const m = text.match(sycophancyRe);
   182→  return m && m.length
   183→    ? { id: 'RT-TONE-SYCOPHANCY', title: 'Sycophancy / empty praise', severity: 'WARN', details: unique(m).slice(0, 10) }
   184→    : { id: 'RT-TONE-SYCOPHANCY', title: 'Sycophancy / empty praise', severity: 'PASS' };
   185→}
   186→
   187→function scanInjection(jd: string): Finding {
   188→  if (!jd) return { id: 'RT-INPUT-INJECTION', title: 'Prompt injection patterns in job description', severity: 'PASS' };
   189→  const m = jd.match(injectionRe);
   190→  return m && m.length
   191→    ? { id: 'RT-INPUT-INJECTION', title: 'Prompt injection patterns in job description', severity: 'WARN', details: unique(m).slice(0, 10) }
   192→    : { id: 'RT-INPUT-INJECTION', title: 'Prompt injection patterns in job description', severity: 'PASS' };
   193→}
   194→
   195→function scanApproxNearMetrics(text: string): Finding {
   196→  // Rough heuristic: if a sentence contains both approx word and metric token -> warn.
   197→  const normalized = text.replace(/\s+/g, ' ').trim();
   198→  const sentences = normalized.split(/(?:\.\s+|\?\s+|!\s+|\n+)/).map(s => s.trim()).filter(Boolean);
   199→
   200→  const flagged: string[] = [];
   201→  for (const s of sentences) {
   202→    if (approxRe.test(s) && metricRe.test(s)) {
   203→      flagged.push(s.length > 160 ? s.slice(0, 157) + '…' : s);
   204→    }
   205→    // reset regex state (global regex)
   206→    approxRe.lastIndex = 0;
   207→    metricRe.lastIndex = 0;
   208→  }
   209→
   210→  return flagged.length
   211→    ? { id: 'RT-ACC-INFLATION', title: 'Approximation language near metrics (inflation risk)', severity: 'WARN', details: flagged.slice(0, 5) }
   212→    : { id: 'RT-ACC-INFLATION', title: 'Approximation language near metrics (inflation risk)', severity: 'PASS' };
   213→}
   214→
   215→function scanClaimsLedger(slug: string, ledger: any | null): Finding {
   216→  if (!ledger) {
   217→    return {
   218→      id: 'RT-ACC-CLAIMS',
   219→      title: 'Claims ledger exists and is verified',
   220→      severity: 'FAIL',
   221→      details: [`Missing ledger: capstone/develop/evals/${slug}.claims.yaml`, 'Run: npm run eval:variant -- --slug ' + slug]
   222→    };
   223→  }
   224→
   225→  const claims: any[] = ledger.claims || [];
   226→  const unverified = claims.filter(c => c?.verified?.status !== 'verified');
   227→
   228→  if (unverified.length) {
   229→    return {
   230→      id: 'RT-ACC-CLAIMS',
   231→      title: 'Claims ledger exists and is verified',
   232→      severity: 'FAIL',
   233→      details: unverified.slice(0, 8).map(c => `${c.id} (${c.location})`)
   234→    };
   235→  }
   236→
   237→  return { id: 'RT-ACC-CLAIMS', title: 'Claims ledger exists and is verified', severity: 'PASS' };
   238→}
   239→
   240→function scanPublicJobDescription(jd: string): Finding {
   241→  if (!jd) return { id: 'RT-PRIV-JD', title: 'Job description exposure risk (public JSON)', severity: 'PASS' };
   242→  // Your variants are shipped client-side as JSON. Long JDs are risky to publish.
   243→  return jd.length > 1200
   244→    ? {
   245→        id: 'RT-PRIV-JD',
   246→        title: 'Job description exposure risk (public JSON)',
   247→        severity: 'WARN',
   248→        details: [
   249→          `jobDescription length is ${jd.length} characters.`,
   250→          'Consider storing only a short excerpt in variant metadata (or stripping it in build).'
   251→        ]
   252→      }
   253→    : { id: 'RT-PRIV-JD', title: 'Job description exposure risk (public JSON)', severity: 'PASS' };
   254→}
   255→
   256→function scanCrossVariantContamination(slug: string, company: string, text: string): Finding {
   257→  const companies = listVariantCompanies();
   258→  const others = companies.filter(c => c && c.toLowerCase() !== company.toLowerCase());
   259→
   260→  const hits: string[] = [];
   261→  for (const o of others) {
   262→    const re = new RegExp(`\\b${escapeRegExp(o)}\\b`, 'i');
   263→    if (re.test(text)) hits.push(o);
   264→  }
   265→
   266→  return hits.length
   267→    ? { id: 'RT-XVAR-CONTAM', title: 'Cross-variant contamination (mentions other target companies)', severity: 'WARN', details: unique(hits) }
   268→    : { id: 'RT-XVAR-CONTAM', title: 'Cross-variant contamination (mentions other target companies)', severity: 'PASS' };
   269→}
   270→
   271→function listVariantCompanies(): string[] {
   272→  const variantsDir = join(process.cwd(), 'content', 'variants');
   273→  if (!existsSync(variantsDir)) return [];
   274→  const slugs = readdirSync(variantsDir)
   275→    .filter(f => f.endsWith('.yaml'))
   276→    .filter(f => !f.startsWith('_'))
   277→    .map(f => f.replace(/\.yaml$/, ''));
   278→
   279→  const companies: string[] = [];
   280→  for (const slug of slugs) {
   281→    try {
   282→      const { validated } = readVariantYaml(slug);
   283→      companies.push(validated.metadata.company);
   284→    } catch {
   285→      // ignore
   286→    }
   287→  }
   288→  return unique(companies);
   289→}
   290→
   291→function escapeRegExp(s: string): string {
   292→  return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
   293→}
   294→
   295→function unique(arr: string[]): string[] {
   296→  return [...new Set(arr)];
   297→}
   298→
   299→function severityScore(sev: Finding['severity']): number {
   300→  return sev === 'FAIL' ? 2 : sev === 'WARN' ? 1 : 0;
   301→}
   302→
   303→function writeReport(slug: string, findings: Finding[]) {
   304→  const dir = join(process.cwd(), 'capstone', 'develop', 'redteam');
   305→  ensureDir(dir);
   306→  const path = join(dir, `${slug}.redteam.md`);
   307→
   308→  const failCount = findings.filter(f => f.severity === 'FAIL').length;
   309→  const warnCount = findings.filter(f => f.severity === 'WARN').length;
   310→
   311→  const lines: string[] = [];
   312→  lines.push(`# Red Team Report`);
   313→  lines.push('');
   314→  lines.push(`- Variant: \`${slug}\``);
   315→  lines.push(`- Generated: ${new Date().toISOString()}`);
   316→  lines.push('');
   317→  lines.push(`## Summary`);
   318→  lines.push('');
   319→  lines.push(`- FAIL: **${failCount}**`);
   320→  lines.push(`- WARN: **${warnCount}**`);
   321→  lines.push('');
   322→  lines.push(`## Checks`);
   323→  lines.push('');
   324→  lines.push(`| ID | Result | Check |`);
   325→  lines.push(`|---|---|---|`);
   326→
   327→  for (const f of findings) {
   328→    const icon = f.severity === 'PASS' ? '✅ PASS' : f.severity === 'WARN' ? '⚠️ WARN' : '❌ FAIL';
   329→    lines.push(`| \`${f.id}\` | ${icon} | ${f.title} |`);
   330→  }
   331→
   332→  lines.push('');
   333→  lines.push(`## Details`);
   334→  lines.push('');
   335→  for (const f of findings.filter(x => x.details && x.details.length)) {
   336→    lines.push(`### ${f.id} — ${f.title}`);
   337→    lines.push('');
   338→    for (const d of f.details!) lines.push(`- ${d}`);
   339→    lines.push('');
   340→  }
   341→
   342→  writeFileSync(path, lines.join('\n') + '\n', 'utf-8');
   343→  return path;
   344→}
   345→
   346→function redteamOne(slug: string, args: Args): RedteamResult {
   347→  try {
   348→    const { validated } = readVariantYaml(slug);
   349→
   350→    const overrideTexts: string[] = [];
   351→    collectStrings(validated.overrides, overrideTexts);
   352→    const text = overrideTexts.join('\n');
   353→
   354→    const jd = validated.metadata?.jobDescription ?? '';
   355→    const ledger = loadClaimsLedger(slug);
   356→
   357→    const findings: Finding[] = [];
   358→
   359→    findings.push(scanClaimsLedger(slug, ledger));
   360→    findings.push(scanSecrets(text));
   361→    findings.push(scanConfidential(text));
   362→    findings.push(scanSycophancy(text));
   363→    findings.push(scanApproxNearMetrics(text));
   364→    findings.push(scanInjection(jd));
   365→    findings.push(scanPublicJobDescription(jd));
   366→    findings.push(scanCrossVariantContamination(slug, validated.metadata.company, text));
   367→
   368→    // Sort: FAIL first, WARN, PASS (nice report)
   369→    findings.sort((a, b) => severityScore(b.severity) - severityScore(a.severity));
   370→
   371→    const reportPath = args.noWrite ? undefined : writeReport(slug, findings);
   372→
   373→    const fails = findings.filter(f => f.severity === 'FAIL');
   374→    const warns = findings.filter(f => f.severity === 'WARN');
   375→    const shouldFail = fails.length > 0 || (args.strict && warns.length > 0);
   376→
   377→    return {
   378→      slug,
   379→      status: shouldFail ? 'fail' : warns.length > 0 ? 'warn' : 'pass',
   380→      fails: fails.length,
   381→      warns: warns.length,
   382→      reportPath,
   383→      findings: args.json ? findings : undefined
   384→    };
   385→  } catch (err) {
   386→    return {
   387→      slug,
   388→      status: 'error',
   389→      fails: 0,
   390→      warns: 0,
   391→      message: err instanceof Error ? err.message : String(err)
   392→    };
   393→  }
   394→}
   395→
   396→async function main() {
   397→  const args = parseArgs();
   398→  const slugs = args.all ? listVariantSlugs() : [args.slug!];
   399→
   400→  // JSON output mode - minimal, machine-readable
   401→  if (args.json) {
   402→    if (slugs.length === 0) {
   403→      console.log(JSON.stringify({ mode: args.check ? 'check' : 'redteam', results: [], errors: [] }));
   404→      process.exit(0);
   405→    }
   406→
   407→    const results = slugs.map(slug => redteamOne(slug, args));
   408→    const output = {
   409→      mode: args.check ? 'check' : 'redteam',
   410→      strict: args.strict,
   411→      results: results.filter(r => r.status !== 'error'),
   412→      errors: results.filter(r => r.status === 'error')
   413→    };
   414→
   415→    console.log(JSON.stringify(output, null, 2));
   416→    const hasFailures = results.some(r => r.status === 'fail' || r.status === 'error');
   417→    process.exit(hasFailures ? 1 : 0);
   418→  }
   419→
   420→  // Interactive output
   421→  if (!args.quiet) {
   422→    console.log(HEADER_COMPACT);
   423→    console.log();
   424→  }
   425→
   426→  if (slugs.length === 0) {
   427→    if (!args.quiet) {
   428→      console.log(theme.muted('No variants found. Nothing to red-team.'));
   429→    }
   430→    process.exit(0);
   431→  }
   432→
   433→  const spinner = ora({
   434→    text: args.check ? 'Checking variants...' : 'Running red team scans...',
   435→    color: 'yellow'
   436→  }).start();
   437→
   438→  const results: RedteamResult[] = [];
   439→
   440→  for (const slug of slugs) {
   441→    const result = redteamOne(slug, args);
   442→    results.push(result);
   443→  }
   444→
   445→  spinner.stop();
   446→
   447→  // Display results
   448→  const passed = results.filter(r => r.status === 'pass');
   449→  const warned = results.filter(r => r.status === 'warn');
   450→  const failed = results.filter(r => r.status === 'fail');
   451→  const errors = results.filter(r => r.status === 'error');
   452→
   453→  if (!args.quiet) {
   454→    console.log(theme.bold(args.check ? 'Red Team Check' : 'Red Team Scan'));
   455→    console.log(theme.muted(`${results.length} variant(s)`));
   456→    console.log();
   457→
   458→    for (const r of results) {
   459→      if (r.status === 'error') {
   460→        console.log(`${theme.icons.error} ${r.slug} ${theme.error('error')}`);
   461→        if (r.message) console.log(theme.muted(`  ${r.message}`));
   462→      } else if (r.status === 'fail') {
   463→        console.log(`${theme.icons.error} ${r.slug} ${theme.error(`${r.fails} FAIL`)} ${theme.warning(`${r.warns} WARN`)}`);
   464→        if (r.reportPath) console.log(theme.muted(`  ${r.reportPath}`));
   465→      } else if (r.status === 'warn') {
   466→        console.log(`${theme.icons.warning} ${r.slug} ${theme.warning(`${r.warns} WARN`)}`);
   467→        if (r.reportPath) console.log(theme.muted(`  ${r.reportPath}`));
   468→      } else {
   469→        console.log(`${theme.icons.success} ${r.slug} ${theme.success('passed')}`);
   470→      }
   471→    }
   472→
   473→    console.log();
   474→    console.log(
   475→      theme.muted('Summary:'),
   476→      `${passed.length} passed,`,
   477→      `${warned.length} warnings,`,
   478→      `${failed.length + errors.length} failed`
   479→    );
   480→  }
   481→
   482→  if (failed.length > 0 || errors.length > 0) {
   483→    process.exit(1);
   484→  }
   485→
   486→  process.exit(0);
   487→}
   488→
   489→main().catch((err) => {
   490→  console.error(`${theme.icons.error} ${theme.error('Fatal:')} ${err instanceof Error ? err.message : String(err)}`);
   491→  process.exit(1);
   492→});
   493→
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Now let me check the CLI theme file and any other supporting files:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./scripts/cli/theme.ts`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** List CLI directory contents

`ls -la /Users/dfotesco/Portfolio/portfolio/scripts/cli/`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** Find capstone development documentation files

`find /Users/dfotesco/Portfolio/portfolio -type f -path "*capstone/develop*" -name "*.md" | head -10`

Result:

```
1→/**
     2→ * Universal CV CLI Theme
     3→ *
     4→ * Design tokens and utilities for consistent CLI output.
     5→ * Colors derived from the portfolio design system (globals.css)
     6→ */
     7→
     8→import chalk from 'chalk';
     9→
    10→// Brand colors from globals.css
    11→const BRAND = {
    12→  accent: '#c29a6c',      // --color-accent (dark mode)
    13→  accentLight: '#8a6642', // --color-accent (light mode)
    14→  success: '#4ade80',     // --color-success
    15→  warning: '#facc15',     // Yellow for warnings
    16→  error: '#ef4444',       // --color-danger
    17→  info: '#60a5fa',        // Blue for info
    18→  muted: '#6b7280',       // Gray for secondary text
    19→};
    20→
    21→// Semantic color functions
    22→export const theme = {
    23→  // Brand
    24→  brand: chalk.hex(BRAND.accent),
    25→  brandBold: chalk.hex(BRAND.accent).bold,
    26→
    27→  // Semantic
    28→  success: chalk.hex(BRAND.success),
    29→  warning: chalk.hex(BRAND.warning),
    30→  error: chalk.hex(BRAND.error),
    31→  info: chalk.hex(BRAND.info),
    32→  muted: chalk.hex(BRAND.muted),
    33→
    34→  // Text variants
    35→  bold: chalk.bold,
    36→  dim: chalk.dim,
    37→  italic: chalk.italic,
    38→
    39→  // Status icons with colors
    40→  icons: {
    41→    success: chalk.hex(BRAND.success)('✓'),
    42→    error: chalk.hex(BRAND.error)('✗'),
    43→    warning: chalk.hex(BRAND.warning)('⚠'),
    44→    info: chalk.hex(BRAND.info)('ℹ'),
    45→    pending: chalk.hex(BRAND.muted)('○'),
    46→    running: chalk.hex(BRAND.info)('●'),
    47→    bullet: chalk.hex(BRAND.muted)('•'),
    48→  },
    49→
    50→  // For pass/fail/warn badges
    51→  badge: {
    52→    pass: chalk.hex(BRAND.success).bold('PASS'),
    53→    fail: chalk.hex(BRAND.error).bold('FAIL'),
    54→    warn: chalk.hex(BRAND.warning).bold('WARN'),
    55→  },
    56→};
    57→
    58→// ASCII Art header - compact version for subcommands
    59→export const HEADER_COMPACT = `
    60→${chalk.hex(BRAND.accent)('╭─────────────────────────────────────────────────────────────────────────────╮')}
    61→${chalk.hex(BRAND.accent)('│')}  ${chalk.hex(BRAND.accent).bold('◆ Universal CV')}                                          ${chalk.dim('Quality Pipeline')}  ${chalk.hex(BRAND.accent)('│')}
    62→${chalk.hex(BRAND.accent)('╰─────────────────────────────────────────────────────────────────────────────╯')}
    63→`.trim();
    64→
    65→// Full ASCII art logo for main entry point
    66→export const HEADER_FULL = `
    67→${chalk.hex(BRAND.accent)('    ██╗   ██╗███╗   ██╗██╗██╗   ██╗███████╗██████╗ ███████╗ █████╗ ██╗')}
    68→${chalk.hex(BRAND.accent)('    ██║   ██║████╗  ██║██║██║   ██║██╔════╝██╔══██╗██╔════╝██╔══██╗██║')}
    69→${chalk.hex(BRAND.accent)('    ██║   ██║██╔██╗ ██║██║██║   ██║█████╗  ██████╔╝███████╗███████║██║')}
    70→${chalk.hex(BRAND.accent)('    ██║   ██║██║╚██╗██║██║╚██╗ ██╔╝██╔══╝  ██╔══██╗╚════██║██╔══██║██║')}
    71→${chalk.hex(BRAND.accent)('    ╚██████╔╝██║ ╚████║██║ ╚████╔╝ ███████╗██║  ██║███████║██║  ██║███████╗')}
    72→${chalk.hex(BRAND.accent)('     ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═══╝  ╚══════╝╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝╚══════╝')}
    73→${chalk.hex(BRAND.accent)('                             ██████╗██╗   ██╗')}
    74→${chalk.hex(BRAND.accent)('                            ██╔════╝██║   ██║')}
    75→${chalk.hex(BRAND.accent)('                            ██║     ██║   ██║')}
    76→${chalk.hex(BRAND.accent)('                            ██║     ╚██╗ ██╔╝')}
    77→${chalk.hex(BRAND.accent)('                            ╚██████╗ ╚████╔╝')}
    78→${chalk.hex(BRAND.accent)('                             ╚═════╝  ╚═══╝')}
    79→
    80→${chalk.dim('                   AI-Powered Portfolio Quality Pipeline')}
    81→`.trim();
    82→
    83→/**
    84→ * Print a section header
    85→ */
    86→export function header(title: string, subtitle?: string): string {
    87→  const line = chalk.hex(BRAND.muted)('─'.repeat(75));
    88→  const header = `${chalk.hex(BRAND.accent).bold(title)}${subtitle ? chalk.dim(` · ${subtitle}`) : ''}`;
    89→  return `\n${header}\n${line}`;
    90→}
    91→
    92→/**
    93→ * Print a box around content
    94→ */
    95→export function box(title: string, content: string): string {
    96→  const lines = content.split('\n');
    97→  const maxWidth = Math.max(title.length + 4, ...lines.map(l => stripAnsi(l).length + 4));
    98→  const width = Math.min(maxWidth, 77);
    99→
   100→  const accent = chalk.hex(BRAND.accent);
   101→  const top = `${accent('╭─')} ${chalk.bold(title)} ${accent('─'.repeat(Math.max(0, width - title.length - 5)))}${accent('╮')}`;
   102→  const bottom = `${accent('╰')}${accent('─'.repeat(width - 1))}${accent('╯')}`;
   103→
   104→  const body = lines.map(line => {
   105→    const stripped = stripAnsi(line);
   106→    const padding = Math.max(0, width - stripped.length - 4);
   107→    return `${accent('│')} ${line}${' '.repeat(padding)} ${accent('│')}`;
   108→  }).join('\n');
   109→
   110→  return [top, body, bottom].join('\n');
   111→}
   112→
   113→/**
   114→ * Format a key-value pair
   115→ */
   116→export function kv(key: string, value: string): string {
   117→  return `${chalk.dim(key + ':')} ${value}`;
   118→}
   119→
   120→/**
   121→ * Format a list item
   122→ */
   123→export function li(text: string, indent = 0): string {
   124→  return `${'  '.repeat(indent)}${theme.icons.bullet} ${text}`;
   125→}
   126→
   127→/**
   128→ * Format a step in a process
   129→ */
   130→export function step(status: 'pending' | 'running' | 'success' | 'error', text: string): string {
   131→  const icon = theme.icons[status] || theme.icons.pending;
   132→  return `${icon} ${text}`;
   133→}
   134→
   135→/**
   136→ * Simple progress bar
   137→ */
   138→export function progressBar(percent: number, width = 40): string {
   139→  const filled = Math.round((percent / 100) * width);
   140→  const empty = width - filled;
   141→  return `${chalk.hex(BRAND.success)('█'.repeat(filled))}${chalk.dim('░'.repeat(empty))} ${percent.toFixed(0)}%`;
   142→}
   143→
   144→/**
   145→ * Strip ANSI codes from a string (for width calculation)
   146→ */
   147→function stripAnsi(str: string): string {
   148→  // eslint-disable-next-line no-control-regex
   149→  return str.replace(/\x1B\[[0-9;]*m/g, '');
   150→}
   151→
   152→/**
   153→ * Detect if running in interactive mode
   154→ */
   155→export function isInteractive(): boolean {
   156→  return process.stdin.isTTY === true &&
   157→         process.stdout.isTTY === true &&
   158→         !process.env.CI &&
   159→         !process.env.UCV_NON_INTERACTIVE;
   160→}
   161→
   162→/**
   163→ * Check if colors should be disabled
   164→ */
   165→export function shouldUseColor(): boolean {
   166→  return !process.env.NO_COLOR &&
   167→         !process.env.UCV_NO_COLOR &&
   168→         (process.stdout.isTTY === true || process.env.FORCE_COLOR === '1');
   169→}
   170→
```

Result:

```
total 16
drwxr-xr-x@ 3 dfotesco  staff    96 Dec 21 12:20 .
drwxr-xr-x@ 9 dfotesco  staff   288 Dec 21 12:20 ..
-rw-r--r--@ 1 dfotesco  staff  7079 Dec 21 12:20 theme.ts
```

Result:

```
/Users/dfotesco/Portfolio/portfolio/capstone/develop/red-teaming.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/executable-quality-pipeline.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/evals/bloomberg-technical-product-manager.eval.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/evals/README.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/redteam/bloomberg-technical-product-manager.redteam.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/redteam/README.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/redteam/mysten-walrus-senior-pm.redteam.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/redteam/gensyn-technical-product-manager.redteam.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/redteam/stripe-crypto.redteam.md
/Users/dfotesco/Portfolio/portfolio/capstone/develop/README.md
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Let me check the capstone documentation files to understand the evaluation and red-teaming frameworks:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./capstone/develop/README.md`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./capstone/develop/executable-quality-pipeline.md`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./capstone/develop/red-teaming.md`

Result:

```
1→# Develop Phase
     2→## Architecture, Implementation & Evaluation
     3→
     4→---
     5→
     6→## Architecture Overview
     7→
     8→\```
     9→┌─────────────────────────────────────────────────────────────────────────────┐
    10→│                           SYSTEM ARCHITECTURE                                │
    11→└─────────────────────────────────────────────────────────────────────────────┘
    12→
    13→                              ┌─────────────────┐
    14→                              │   User Input    │
    15→                              │  (Job Desc/     │
    16→                              │   Query)        │
    17→                              └────────┬────────┘
    18→                                       │
    19→                                       ▼
    20→┌─────────────────────────────────────────────────────────────────────────────┐
    21→│                            CLAUDE CODE SKILLS                                │
    22→│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
    23→│  │ cv-knowledge-   │  │ cv-content-     │  │ cv-content-     │             │
    24→│  │ query           │  │ generator       │  │ editor          │             │
    25→│  │                 │  │                 │  │                 │             │
    26→│  │ "What's my      │  │ "Create variant │  │ "Update the     │             │
    27→│  │  crypto exp?"   │  │  for Stripe"    │  │  Ankr numbers"  │             │
    28→│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘             │
    29→│           │                    │                    │                       │
    30→└───────────┼────────────────────┼────────────────────┼───────────────────────┘
    31→            │                    │                    │
    32→            ▼                    ▼                    ▼
    33→┌─────────────────────────────────────────────────────────────────────────────┐
    34→│                         KNOWLEDGE BASE (Source of Truth)                     │
    35→│                            content/knowledge/                                │
    36→│                                                                              │
    37→│  ┌──────────────────────────────────────────────────────────────────────┐   │
    38→│  │                           index.yaml                                  │   │
    39→│  │  Entities: companies, themes, skills                                  │   │
    40→│  │  Relationships: achieved_at, demonstrates, belongs_to                 │   │
    41→│  └──────────────────────────────────────────────────────────────────────┘   │
    42→│                                                                              │
    43→│  ┌─────────────────────┐              ┌─────────────────────┐              │
    44→│  │    achievements/    │              │      stories/       │              │
    45→│  │  ┌───────────────┐  │              │  ┌───────────────┐  │              │
    46→│  │  │ STAR Format   │  │              │  │ Narrative     │  │              │
    47→│  │  │ • Situation   │  │──────────────│  │ • Hook        │  │              │
    48→│  │  │ • Task        │  │   contains   │  │ • Problem     │  │              │
    49→│  │  │ • Action      │  │              │  │ • Insight     │  │              │
    50→│  │  │ • Result      │  │              │  │ • Outcome     │  │              │
    51→│  │  │ • Metrics     │  │              │  │ • Reflection  │  │              │
    52→│  │  └───────────────┘  │              │  └───────────────┘  │              │
    53→│  └─────────────────────┘              └─────────────────────┘              │
    54→│                                                                              │
    55→└─────────────────────────────────────────────────────────────────────────────┘
    56→            │                    │                    │
    57→            ▼                    ▼                    ▼
    58→┌─────────────────────────────────────────────────────────────────────────────┐
    59→│                       PRESENTATION LAYER (Output)                            │
    60→│                                                                              │
    61→│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
    62→│  │   content/  │  │   content/  │  │   content/  │  │   content/  │        │
    63→│  │case-studies/│  │ experience/ │  │  variants/  │  │    blog/    │        │
    64→│  │    /*.md    │  │ index.yaml  │  │   /*.yaml   │  │    /*.md    │        │
    65→│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │
    66→│                                                                              │
    67→└─────────────────────────────────────────────────────────────────────────────┘
    68→                                       │
    69→                                       ▼
    70→┌─────────────────────────────────────────────────────────────────────────────┐
    71→│                         PORTFOLIO WEBSITE                                    │
    72→│                                                                              │
    73→│     edgeoftrust.com/#/              edgeoftrust.com/#/stripe/platform-pm    │
    74→│     (Base Portfolio)                (Personalized Variant)                   │
    75→│                                                                              │
    76→└─────────────────────────────────────────────────────────────────────────────┘
    77→\```
    78→
    79→---
    80→
    81→## Implementation Status
    82→
    83→### Completed Components
    84→
    85→| Component | Location | Status |
    86→|-----------|----------|--------|
    87→| Knowledge base structure | `content/knowledge/` | ✅ Complete |
    88→| Entity index with relationships | `content/knowledge/index.yaml` | ✅ Complete |
    89→| Achievement schema (STAR format) | `content/knowledge/achievements/_template.yaml` | ✅ Complete |
    90→| Story schema | `content/knowledge/stories/_template.yaml` | ✅ Complete |
    91→| 6 achievements extracted | `content/knowledge/achievements/*.yaml` | ✅ Complete |
    92→| 1 story documented | `content/knowledge/stories/galaxy-compliance-win.yaml` | ✅ Complete |
    93→| cv-knowledge-query skill | `.claude/skills/cv-knowledge-query/` | ✅ Complete |
    94→| cv-content-generator skill | `.claude/skills/cv-content-generator/` | ✅ Complete |
    95→| cv-content-editor skill | `.claude/skills/cv-content-editor/` | ✅ Complete |
    96→
    97→### In Progress
    98→
    99→| Component | Status | Next Steps |
   100→|-----------|--------|------------|
   101→| More achievement extraction | 🟡 6/15+ | Extract from remaining experience |
   102→| Evaluation framework | 🟡 Designed | Implement rubrics |
   103→| Red teaming exercises | 🟡 Planned | Execute and document |
   104→
   105→### Not Started
   106→
   107→| Component | Priority |
   108→|-----------|----------|
   109→| Analytics integration | Medium |
   110→| A/B testing framework | Low |
   111→| Automated validation | Medium |
   112→
   113→---
   114→
   115→## Data Schemas
   116→
   117→### Achievement Schema
   118→\```yaml
   119→id: string                    # Unique identifier
   120→headline: string              # One-line resume bullet
   121→metric:
   122→  value: string               # The number
   123→  unit: string                # What it measures
   124→  context: string             # Why it matters
   125→situation: string             # STAR: Context
   126→task: string                  # STAR: Responsibility
   127→action: string                # STAR: What you did
   128→result: string                # STAR: Outcome
   129→skills: [string]              # Skills demonstrated
   130→themes: [string]              # Business themes
   131→companies: [string]           # Company context
   132→years: [number]               # Applicable years
   133→good_for: [string]            # Role fit hints
   134→evidence:
   135→  case_study: string | null   # Link to case study
   136→  testimonial: string | null  # Link to testimonial
   137→  artifacts: [string]         # Supporting evidence
   138→\```
   139→
   140→### Relationship Types
   141→\```yaml
   142→achieved_at:    Achievement → Company     # Where it happened
   143→demonstrates:   Achievement → Skill       # What it proves
   144→belongs_to:     Achievement → Theme       # Business category
   145→contains:       Story → Achievement       # Narrative includes
   146→generated_from: CaseStudy → Story         # Content source
   147→\```
   148→
   149→---
   150→
   151→## AI-Specific Documentation
   152→
   153→| Document | Description |
   154→|----------|-------------|
   155→| [Evaluation Framework](./evaluation.md) | Rubrics for measuring AI output quality |
   156→| [Red Teaming Report](./red-teaming.md) | Failure modes, attacks, and mitigations |
   157→| [Guardrails Design](./guardrails.md) | Architectural safeguards |
   158→| [Human-in-the-Loop](./hitl.md) | Where humans review AI decisions |
   159→
   160→---
   161→
   162→## Development Decisions
   163→
   164→### Decision 1: File-based vs. Database
   165→**Choice:** File-based (YAML/Markdown)
   166→**Rationale:**
   167→- Version controlled with Git
   168→- No backend infrastructure needed
   169→- Easy to edit manually
   170→- Works with static site deployment
   171→
   172→### Decision 2: Claude Code Skills vs. External API
   173→**Choice:** Claude Code Skills
   174→**Rationale:**
   175→- Integrated with development workflow
   176→- No API costs or rate limits
   177→- Full context awareness
   178→- Iterative development friendly
   179→
   180→### Decision 3: STAR Format for Achievements
   181→**Choice:** Structured STAR format
   182→**Rationale:**
   183→- Industry standard for behavioral interviews
   184→- Provides complete context for generation
   185→- Enables consistent quality
   186→- Doubles as interview prep
   187→
   188→### Decision 4: Knowledge Base as Single Source of Truth
   189→**Choice:** All facts in knowledge base, presentation derived
   190→**Rationale:**
   191→- Prevents hallucination (can only use what exists)
   192→- Ensures consistency across outputs
   193→- Enables traceability for audits
   194→- Simplifies updates (change once, sync everywhere)
   195→
   196→---
   197→
   198→## Testing Strategy
   199→
   200→### Unit Testing
   201→- Schema validation for all content files
   202→- Relationship integrity in knowledge graph
   203→- Skill prompt parsing
   204→
   205→### Integration Testing
   206→- End-to-end variant generation
   207→- Knowledge base query accuracy
   208→- Sync between layers
   209→
   210→### Quality Testing
   211→- Manual review of generated content
   212→- Evaluation rubric scoring
   213→- Red teaming exercises
   214→
   215→---
   216→
   217→## Next Steps
   218→
   219→1. Complete evaluation framework implementation
   220→2. Execute red teaming exercises
   221→3. Extract remaining achievements
   222→4. Build automated validation
   223→
   224→---
   225→
   226→## Supporting Documents
   227→
   228→- [Architecture Details](./architecture.md)
   229→- [Evaluation Framework](./evaluation.md)
   230→- [Red Teaming Report](./red-teaming.md)
   231→- [Guardrails Design](./guardrails.md)
   232→- [Human-in-the-Loop](./hitl.md)
   233→
   234→---
   235→
   236→## Transition to Deliver
   237→
   238→**Ready for Delivery When:**
   239→- [ ] Evaluation framework tested
   240→- [ ] Red teaming complete with mitigations
   241→- [ ] 10+ achievements in knowledge base
   242→- [ ] 3+ variants generated and reviewed
   243→- [ ] Documentation complete
   244→
   245→→ Proceed to [Deliver Phase](../deliver/README.md)
   246→
```

Result:

```
1→# Executable Quality Pipeline
     2→## Capstone: from docs → repeatable product behavior
     3→
     4→This capstone folder contains **two layers**:
     5→
     6→1) **Conceptual frameworks** (rubrics, threat model)  
     7→2) **Executable tooling** that makes those frameworks *real* and repeatable
     8→
     9→Your goal is not just “have good docs” — it’s to build the muscle of:
    10→
    11→> **Truth → Output → Evaluation → Red Team → Ship → Iterate**
    12→
    13→---
    14→
    15→## The system you built in this repo
    16→
    17→### Canonical vs runtime artifacts
    18→
    19→- **Canonical variants (edit these):** `content/variants/*.yaml`  
    20→- **Runtime variants (site loads these):** `content/variants/*.json`
    21→
    22→The website loads variants using Vite’s JSON glob import, so JSON must exist and match YAML.
    23→
    24→That’s why we added a deterministic sync step:
    25→
    26→\```bash
    27→npm run variants:sync
    28→npm run variants:check
    29→\```
    30→
    31→---
    32→
    33→## Phase 1: Keep variants coherent
    34→### (YAML is the source of truth)
    35→
    36→**What you do**
    37→- Edit YAML variants
    38→- Generate JSON from YAML
    39→
    40→**Commands**
    41→\```bash
    42→npm run variants:sync          # writes/updates JSON to match YAML
    43→npm run variants:check         # fails if YAML/JSON drift exists
    44→\```
    45→
    46→**Artifacts**
    47→- `content/variants/<slug>.yaml`
    48→- `content/variants/<slug>.json`
    49→
    50→---
    51→
    52→## Phase 2: Make evaluation executable
    53→### (claims ledger → machine-checkable)
    54→
    55→Your evaluation rubric lives here:
    56→- `capstone/develop/evaluation.md`
    57→
    58→The executable version of “accuracy” is the **claims ledger**:
    59→- `capstone/develop/evals/<slug>.claims.yaml`
    60→
    61→**Generate / refresh the ledger**
    62→\```bash
    63→npm run eval:variant -- --slug <slug>
    64→\```
    65→
    66→This produces:
    67→- `capstone/develop/evals/<slug>.claims.yaml`
    68→- `capstone/develop/evals/<slug>.eval.md`
    69→
    70→**What the ledger does**
    71→- Extracts metric-like claims (numbers, %, $, ×, +, “billions”, “zero”, etc.)
    72→- Suggests candidate source files from `content/knowledge/**`
    73→- Requires you to mark each claim as VERIFIED with a source + anchors
    74→
    75→**Gate**
    76→\```bash
    77→npm run eval:check
    78→\```
    79→
    80→`eval:check` fails if:
    81→- the ledger is missing
    82→- the variant changed since the ledger was generated (hash mismatch)
    83→- any claim is unverified
    84→- any verified anchor no longer exists in the source (regression)
    85→
    86→---
    87→
    88→## Phase 2.5: “Verified sources” write-back
    89→
    90→You can mark a claim verified from the CLI:
    91→
    92→\```bash
    93→npm run eval:variant -- --slug <slug> --verify <claimId>=<sourcePath>
    94→\```
    95→
    96→This updates the ledger so your evaluation becomes **machine-checkable over time**.
    97→
    98→---
    99→
   100→## Phase 3: Red team as a repeatable scan
   101→### (failure modes become checks)
   102→
   103→Your threat model lives here:
   104→- `capstone/develop/red-teaming.md`
   105→
   106→The executable scan writes a report:
   107→- `capstone/develop/redteam/<slug>.redteam.md`
   108→
   109→**Run**
   110→\```bash
   111→npm run redteam:variant -- --slug <slug>
   112→\```
   113→
   114→**Gate**
   115→\```bash
   116→npm run redteam:check
   117→npm run redteam:check -- --strict   # WARN becomes FAIL
   118→\```
   119→
   120→This scan is intentionally grounded to portfolio risks:
   121→- missing/unverified claims ledger (hard fail)
   122→- secrets / tokens in text (hard fail)
   123→- confidentiality / NDA language (hard fail)
   124→- sycophancy phrases (warn)
   125→- approximation language near metrics (warn)
   126→- prompt injection patterns inside job descriptions (warn)
   127→- job description exposure risk (warn)
   128→- cross-variant contamination (warn)
   129→
   130→---
   131→
   132→## The capstone PM loop (memorize this)
   133→
   134→\```
   135→Truth (KB)  →  Variant (YAML)  →  Sync (JSON)  →  Evaluate (claims ledger)
   136→   ↑                                                    ↓
   137→   └────────────── Fix facts in KB, not in output ───────┘
   138→                         ↓
   139→                   Red Team (static scan)
   140→                         ↓
   141→                      Ship (deploy)
   142→                         ↓
   143→                Track results + iterate
   144→\```
   145→
   146→---
   147→
   148→## How to use this on future projects
   149→
   150→This pattern generalizes:
   151→
   152→- Replace “variants” with “prompts”, “policies”, “configs”
   153→- Replace “knowledge base” with “source docs / requirements / specs”
   154→- Replace “claims ledger” with any *traceability layer*
   155→- Replace “redteam scan” with “abuse tests / threat model checks / safety checks”
   156→
   157→The key deliverable is **the workflow** — not the scripts.
   158→
   159→
```

Result:

```
1→# Red Teaming Report
     2→## Adversarial Testing of Universal CV
     3→
     4→---
     5→
     6→## Overview
     7→
     8→This document identifies potential failure modes, attacks, and misuse scenarios for the Universal CV system. For each threat, we assess likelihood, impact, and implement mitigations.
     9→---
    10→
    11→## Executable Version (CLI)
    12→
    13→This doc is the **threat model**.
    14→
    15→The executable scan lives here:
    16→
    17→- Generate a report:
    18→  \```bash
    19→  npm run redteam:variant -- --slug <slug>
    20→  \```
    21→- Strict gate:
    22→  \```bash
    23→  npm run redteam:check
    24→  npm run redteam:check -- --strict
    25→  \```
    26→
    27→Outputs:
    28→- `capstone/develop/redteam/<slug>.redteam.md`
    29→
    30→
    31→
    32→---
    33→
    34→## Threat Model
    35→
    36→### System Boundaries
    37→
    38→\```
    39→┌─────────────────────────────────────────────────────────────────────────────┐
    40→│                           THREAT SURFACE                                     │
    41→└─────────────────────────────────────────────────────────────────────────────┘
    42→
    43→  TRUSTED                          BOUNDARY                      UNTRUSTED
    44→  ───────                          ────────                      ─────────
    45→
    46→  ┌─────────────┐                                            ┌─────────────┐
    47→  │  Knowledge  │                                            │   Job       │
    48→  │  Base       │◄─── User controls content ────────────────▶│Description  │
    49→  │  (YAML)     │                                            │  (Input)    │
    50→  └─────────────┘                                            └─────────────┘
    51→        │                                                           │
    52→        ▼                                                           ▼
    53→  ┌─────────────┐                                            ┌─────────────┐
    54→  │  Claude     │                                            │  Generated  │
    55→  │  Skills     │◄─── AI processing ────────────────────────▶│  Variant    │
    56→  │             │                                            │  (Output)   │
    57→  └─────────────┘                                            └─────────────┘
    58→        │                                                           │
    59→        ▼                                                           ▼
    60→  ┌─────────────┐                                            ┌─────────────┐
    61→  │  Human      │                                            │  Recruiter  │
    62→  │  Review     │◄─── Trust boundary ───────────────────────▶│  (Viewer)   │
    63→  └─────────────┘                                            └─────────────┘
    64→\```
    65→
    66→### Threat Actors
    67→
    68→| Actor | Motivation | Capability |
    69→|-------|------------|------------|
    70→| **Self (misuse)** | Temptation to exaggerate | Full system access |
    71→| **AI (failure)** | None (unintentional) | Content generation |
    72→| **Competitor** | Expose AI-generated content | External observation |
    73→| **Recruiter** | Verify authenticity | Interview, reference checks |
    74→
    75→---
    76→
    77→## Threat Categories
    78→
    79→### Category 1: Accuracy Failures
    80→
    81→#### Threat 1.1: Hallucination
    82→**Description:** AI generates achievements not present in knowledge base.
    83→
    84→| Attribute | Assessment |
    85→|-----------|------------|
    86→| Likelihood | Medium |
    87→| Impact | High |
    88→| Risk Level | **High** |
    89→
    90→**Attack Scenario:**
    91→\```
    92→User: "Create variant for Coinbase"
    93→AI: "Led cryptocurrency compliance initiatives resulting in $50M in
    94→     institutional assets under management"
    95→
    96→Problem: $50M AUM was never stated in knowledge base
    97→\```
    98→
    99→**Mitigation:**
   100→- Knowledge base as sole source of facts
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Now let me check the validation and schemas to understand the CLI better:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./scripts/validate-content.ts`

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Bash** Find schema definition files

`find /Users/dfotesco/Portfolio/portfolio/src -name "schemas.ts" -o -name "schema*"`

Result:

```
1→#!/usr/bin/env tsx
     2→/**
     3→ * Content Validation CLI
     4→ *
     5→ * Validates all portfolio content files against Zod schemas.
     6→ * Run before committing to catch content errors early.
     7→ *
     8→ * Usage:
     9→ *   npm run validate
    10→ */
    11→
    12→import { readFileSync, readdirSync } from 'fs';
    13→import { join } from 'path';
    14→import YAML from 'yaml';
    15→import { z } from 'zod';
    16→import {
    17→  ProfileSchema,
    18→  ExperienceSchema,
    19→  TestimonialsSchema,
    20→  CertificationsSchema,
    21→  SkillsSchema,
    22→  SocialSchema,
    23→  CaseStudySchema,
    24→  PassionProjectsSchema,
    25→  BlogPostSchema,
    26→  VariantSchema
    27→} from '../src/lib/schemas.js';
    28→
    29→// ANSI color codes for terminal output
    30→const colors = {
    31→  reset: '\x1b[0m',
    32→  green: '\x1b[32m',
    33→  red: '\x1b[31m',
    34→  yellow: '\x1b[33m',
    35→  blue: '\x1b[34m',
    36→  gray: '\x1b[90m'
    37→};
    38→
    39→interface ValidationResult {
    40→  file: string;
    41→  success: boolean;
    42→  errors?: string[];
    43→}
    44→
    45→// Parse frontmatter from markdown
    46→function parseFrontmatter(raw: string): { frontmatter: Record<string, unknown>; content: string } {
    47→  const match = raw.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
    48→  if (!match) return { frontmatter: {}, content: raw };
    49→
    50→  const frontmatterStr = match[1];
    51→  const content = match[2].trim();
    52→
    53→  try {
    54→    const frontmatter = YAML.parse(frontmatterStr);
    55→    return { frontmatter, content };
    56→  } catch (error) {
    57→    console.error('Failed to parse frontmatter:', error);
    58→    return { frontmatter: {}, content: raw };
    59→  }
    60→}
    61→
    62→// Validate a single file against a Zod schema
    63→function validateFile(
    64→  filePath: string,
    65→  schema: z.ZodSchema,
    66→  data: unknown
    67→): ValidationResult {
    68→  try {
    69→    schema.parse(data);
    70→    return { file: filePath, success: true };
    71→  } catch (error) {
    72→    if (error instanceof z.ZodError) {
    73→      const errors = error.errors.map(err => {
    74→        const path = err.path.join('.');
    75→        return `  ${colors.red}✗${colors.reset} ${path}: ${err.message}`;
    76→      });
    77→      return { file: filePath, success: false, errors };
    78→    }
    79→    return {
    80→      file: filePath,
    81→      success: false,
    82→      errors: [`  ${colors.red}✗${colors.reset} Unknown error: ${error}`]
    83→    };
    84→  }
    85→}
    86→
    87→// Validate YAML files
    88→function validateYamlFile(filePath: string, schema: z.ZodSchema): ValidationResult {
    89→  try {
    90→    const content = readFileSync(filePath, 'utf-8');
    91→    const data = YAML.parse(content);
    92→    return validateFile(filePath, schema, data);
    93→  } catch (error) {
    94→    return {
    95→      file: filePath,
    96→      success: false,
    97→      errors: [`  ${colors.red}✗${colors.reset} Failed to read/parse: ${error}`]
    98→    };
    99→  }
   100→}
   101→
   102→// Validate markdown files with frontmatter
   103→function validateMarkdownFile(filePath: string, schema: z.ZodSchema): ValidationResult {
   104→  try {
   105→    const content = readFileSync(filePath, 'utf-8');
   106→    const { frontmatter, content: body } = parseFrontmatter(content);
   107→
   108→    // Combine frontmatter with content for validation
   109→    const data = { ...frontmatter, content: body };
   110→    return validateFile(filePath, schema, data);
   111→  } catch (error) {
   112→    return {
   113→      file: filePath,
   114→      success: false,
   115→      errors: [`  ${colors.red}✗${colors.reset} Failed to read/parse: ${error}`]
   116→    };
   117→  }
   118→}
   119→
   120→// Main validation function
   121→async function validateAllContent(): Promise<void> {
   122→  console.log(`${colors.blue}Validating portfolio content...${colors.reset}\n`);
   123→
   124→  const results: ValidationResult[] = [];
   125→  const contentDir = join(process.cwd(), 'content');
   126→
   127→  // Validate single YAML files
   128→  const singleYamlFiles = [
   129→    { path: 'profile.yaml', schema: ProfileSchema, label: 'Profile' },
   130→    { path: 'experience/index.yaml', schema: ExperienceSchema, label: 'Experience' },
   131→    { path: 'testimonials/index.yaml', schema: TestimonialsSchema, label: 'Testimonials' },
   132→    { path: 'certifications/index.yaml', schema: CertificationsSchema, label: 'Certifications' },
   133→    { path: 'skills/index.yaml', schema: SkillsSchema, label: 'Skills' },
   134→    { path: 'social/index.yaml', schema: SocialSchema, label: 'Social' },
   135→    { path: 'passion-projects/index.yaml', schema: PassionProjectsSchema, label: 'Passion Projects' }
   136→  ];
   137→
   138→  console.log(`${colors.gray}Validating YAML files...${colors.reset}`);
   139→  for (const { path, schema, label } of singleYamlFiles) {
   140→    const fullPath = join(contentDir, path);
   141→    const result = validateYamlFile(fullPath, schema);
   142→    results.push(result);
   143→
   144→    if (result.success) {
   145→      console.log(`${colors.green}✓${colors.reset} ${label} (${path})`);
   146→    } else {
   147→      console.log(`${colors.red}✗${colors.reset} ${label} (${path})`);
   148→      result.errors?.forEach(err => console.log(err));
   149→    }
   150→  }
   151→
   152→  // Validate case studies
   153→  console.log(`\n${colors.gray}Validating case studies...${colors.reset}`);
   154→  const caseStudiesDir = join(contentDir, 'case-studies');
   155→  const caseStudyFiles = readdirSync(caseStudiesDir).filter(f => f.endsWith('.md'));
   156→
   157→  for (const file of caseStudyFiles) {
   158→    const fullPath = join(caseStudiesDir, file);
   159→    const result = validateMarkdownFile(fullPath, CaseStudySchema);
   160→    results.push(result);
   161→
   162→    if (result.success) {
   163→      console.log(`${colors.green}✓${colors.reset} Case Study: ${file}`);
   164→    } else {
   165→      console.log(`${colors.red}✗${colors.reset} Case Study: ${file}`);
   166→      result.errors?.forEach(err => console.log(err));
   167→    }
   168→  }
   169→
   170→  // Validate blog posts
   171→  console.log(`\n${colors.gray}Validating blog posts...${colors.reset}`);
   172→  const blogDir = join(contentDir, 'blog');
   173→  const blogFiles = readdirSync(blogDir).filter(f => f.endsWith('.md'));
   174→
   175→  for (const file of blogFiles) {
   176→    const fullPath = join(blogDir, file);
   177→    const result = validateMarkdownFile(fullPath, BlogPostSchema);
   178→    results.push(result);
   179→
   180→    if (result.success) {
   181→      console.log(`${colors.green}✓${colors.reset} Blog Post: ${file}`);
   182→    } else {
   183→      console.log(`${colors.red}✗${colors.reset} Blog Post: ${file}`);
   184→      result.errors?.forEach(err => console.log(err));
   185→    }
   186→  }
   187→
   188→  // Validate variants
   189→  console.log(`\n${colors.gray}Validating portfolio variants...${colors.reset}`);
   190→  const variantsDir = join(contentDir, 'variants');
   191→  try {
   192→    const variantFiles = readdirSync(variantsDir).filter(f => f.endsWith('.yaml') && !f.startsWith('_'));
   193→
   194→    if (variantFiles.length === 0) {
   195→      console.log(`${colors.gray}  No variants found (this is OK)${colors.reset}`);
   196→    } else {
   197→      for (const file of variantFiles) {
   198→        const fullPath = join(variantsDir, file);
   199→        const result = validateYamlFile(fullPath, VariantSchema);
   200→        results.push(result);
   201→
   202→        if (result.success) {
   203→          console.log(`${colors.green}✓${colors.reset} Variant: ${file}`);
   204→        } else {
   205→          console.log(`${colors.red}✗${colors.reset} Variant: ${file}`);
   206→          result.errors?.forEach(err => console.log(err));
   207→        }
   208→      }
   209→    }
   210→  } catch (error) {
   211→    console.log(`${colors.gray}  Variants directory not found (this is OK)${colors.reset}`);
   212→  }
   213→
   214→  // Summary
   215→  const passed = results.filter(r => r.success).length;
   216→  const failed = results.filter(r => !r.success).length;
   217→
   218→  console.log('\n' + '─'.repeat(50));
   219→  if (failed === 0) {
   220→    console.log(`${colors.green}✓ All ${passed} content files validated successfully!${colors.reset}`);
   221→    process.exit(0);
   222→  } else {
   223→    console.log(`${colors.red}✗ ${failed} file(s) failed validation${colors.reset}`);
   224→    console.log(`${colors.green}✓ ${passed} file(s) passed${colors.reset}`);
   225→    process.exit(1);
   226→  }
   227→}
   228→
   229→// Run validation
   230→validateAllContent().catch((error) => {
   231→  console.error(`${colors.red}Fatal error:${colors.reset}`, error);
   232→  process.exit(1);
   233→});
   234→
```

Result:

```
/Users/dfotesco/Portfolio/portfolio/src/lib/schemas.ts
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Let me check the schemas file:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./src/lib/schemas.ts`

Result:

```
1→/**
     2→ * Zod validation schemas for all content types
     3→ *
     4→ * Shared between content loader and validation CLI
     5→ */
     6→
     7→import { z } from 'zod';
     8→
     9→// ------------------------------------------------------------------
    10→// PROFILE
    11→// ------------------------------------------------------------------
    12→
    13→const HeadlineSegmentSchema = z.object({
    14→  text: z.string(),
    15→  style: z.enum(['italic', 'muted', 'accent', 'normal']).optional().default('normal')
    16→});
    17→
    18→const CtaButtonSchema = z.object({
    19→  label: z.string(),
    20→  href: z.string()
    21→});
    22→
    23→const StatSchema = z.object({
    24→  value: z.string(),
    25→  label: z.string()
    26→});
    27→
    28→export const ProfileSchema = z.object({
    29→  name: z.string(),
    30→  ens: z.string(),
    31→  email: z.string().email(),
    32→  location: z.string(),
    33→  timezone: z.string(),
    34→  photo: z.string(),
    35→  hero: z.object({
    36→    status: z.string(),
    37→    headline: z.array(HeadlineSegmentSchema),
    38→    subheadline: z.string(),
    39→    cta: z.object({
    40→      primary: CtaButtonSchema,
    41→      secondary: CtaButtonSchema
    42→    })
    43→  }),
    44→  about: z.object({
    45→    tagline: z.string(),
    46→    bio: z.array(z.string()),
    47→    stats: z.array(StatSchema)
    48→  }),
    49→  sections: z.object({
    50→    beyondWork: z.boolean(),
    51→    blog: z.boolean(),
    52→    onchainIdentity: z.boolean(),
    53→    skills: z.boolean(),
    54→    passionProjects: z.boolean()
    55→  })
    56→});
    57→
    58→// ------------------------------------------------------------------
    59→// EXPERIENCE
    60→// ------------------------------------------------------------------
    61→
    62→const JobSchema = z.object({
    63→  company: z.string(),
    64→  role: z.string(),
    65→  period: z.string(),
    66→  location: z.string(),
    67→  logo: z.string().nullable().optional(),
    68→  highlights: z.array(z.string()),
    69→  tags: z.array(z.string()),
    70→  url: z.string().nullable().optional()
    71→});
    72→
    73→export const ExperienceSchema = z.object({
    74→  jobs: z.array(JobSchema)
    75→});
    76→
    77→// ------------------------------------------------------------------
    78→// TESTIMONIALS
    79→// ------------------------------------------------------------------
    80→
    81→const TestimonialSchema = z.object({
    82→  quote: z.string(),
    83→  author: z.string(),
    84→  initials: z.string().optional(),
    85→  role: z.string(),
    86→  company: z.string(),
    87→  avatar: z.string().nullable().optional(),
    88→  featured: z.boolean()
    89→});
    90→
    91→export const TestimonialsSchema = z.object({
    92→  testimonials: z.array(TestimonialSchema)
    93→});
    94→
    95→// ------------------------------------------------------------------
    96→// CERTIFICATIONS
    97→// ------------------------------------------------------------------
    98→
    99→const CertificationSchema = z.object({
   100→  name: z.string(),
   101→  issuer: z.string(),
   102→  date: z.string(),
   103→  credentialId: z.string().nullable().optional(),
   104→  url: z.string().nullable().optional(),
   105→  logo: z.string().nullable().optional(),
   106→  featured: z.boolean(),
   107→  instructor: z.string().nullable().optional(),
   108→  instructorRole: z.string().nullable().optional()
   109→});
   110→
   111→const CredentialSchema = z.object({
   112→  label: z.string(),
   113→  value: z.string(),
   114→  url: z.string().nullable().optional()
   115→});
   116→
   117→const OnchainLinkSchema = z.object({
   118→  name: z.string(),
   119→  url: z.string(),
   120→  icon: z.string()
   121→});
   122→
   123→export const CertificationsSchema = z.object({
   124→  certifications: z.array(CertificationSchema),
   125→  credentials: z.array(CredentialSchema),
   126→  onchainIdentity: z.object({
   127→    ens: z.string(),
   128→    links: z.array(OnchainLinkSchema)
   129→  })
   130→});
   131→
   132→// ------------------------------------------------------------------
   133→// SKILLS
   134→// ------------------------------------------------------------------
   135→
   136→const SkillCategorySchema = z.object({
   137→  name: z.string(),
   138→  skills: z.array(z.string())
   139→});
   140→
   141→export const SkillsSchema = z.object({
   142→  categories: z.array(SkillCategorySchema)
   143→});
   144→
   145→// ------------------------------------------------------------------
   146→// SOCIAL
   147→// ------------------------------------------------------------------
   148→
   149→const SocialLinkSchema = z.object({
   150→  platform: z.string(),
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Perfect! Let me get more of the schemas file, especially the VariantSchema:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./src/lib/schemas.ts`

Result:

```
150→  platform: z.string(),
   151→  label: z.string(),
   152→  handle: z.string().optional(),
   153→  url: z.string(),
   154→  icon: z.string(),
   155→  primary: z.boolean()
   156→});
   157→
   158→const ContactCtaButtonSchema = z.object({
   159→  label: z.string(),
   160→  href: z.string(),
   161→  style: z.enum(['primary', 'secondary'])
   162→});
   163→
   164→const ContactCtaSchema = z.object({
   165→  headline: z.string(),
   166→  subtext: z.string(),
   167→  buttons: z.array(ContactCtaButtonSchema)
   168→});
   169→
   170→const NewsletterSchema = z.object({
   171→  enabled: z.boolean(),
   172→  launchDate: z.string().optional(),
   173→  teaser: z.string().optional()
   174→});
   175→
   176→export const SocialSchema = z.object({
   177→  links: z.array(SocialLinkSchema),
   178→  contactCta: ContactCtaSchema,
   179→  newsletter: NewsletterSchema.optional()
   180→});
   181→
   182→// ------------------------------------------------------------------
   183→// CASE STUDIES
   184→// ------------------------------------------------------------------
   185→
   186→const ImpactMetricSchema = z.object({
   187→  value: z.string(),
   188→  label: z.string()
   189→});
   190→
   191→const CaseStudyCtaSchema = z.object({
   192→  headline: z.string(),
   193→  subtext: z.string().optional(),
   194→  action: z.enum(['contact', 'calendly', 'linkedin']),
   195→  linkText: z.string()
   196→});
   197→
   198→export const CaseStudySchema = z.object({
   199→  id: z.number(),
   200→  slug: z.string(),
   201→  title: z.string(),
   202→  company: z.string(),
   203→  year: z.string(),
   204→  tags: z.array(z.string()),
   205→  duration: z.string(),
   206→  role: z.string(),
   207→  hook: z.object({
   208→    headline: z.string(),
   209→    impactMetric: ImpactMetricSchema,
   210→    subMetrics: z.array(ImpactMetricSchema).optional(),
   211→    thumbnail: z.string().nullable()
   212→  }),
   213→  demoUrl: z.string().nullable().optional(),
   214→  githubUrl: z.string().nullable().optional(),
   215→  docsUrl: z.string().nullable().optional(),
   216→  media: z.array(z.object({
   217→    type: z.enum(['blog', 'twitter', 'linkedin', 'video', 'article', 'slides']),
   218→    url: z.string(),
   219→    label: z.string().optional()
   220→  })).optional(),
   221→  cta: CaseStudyCtaSchema,
   222→  content: z.string()
   223→});
   224→
   225→// ------------------------------------------------------------------
   226→// PASSION PROJECTS
   227→// ------------------------------------------------------------------
   228→
   229→const PassionProjectSchema = z.object({
   230→  id: z.number(),
   231→  slug: z.string(),
   232→  title: z.string(),
   233→  tagline: z.string(),
   234→  year: z.string(),
   235→  tags: z.array(z.string()),
   236→  thumbnail: z.string().nullable().optional(),
   237→  githubUrl: z.string().nullable().optional(),
   238→  liveUrl: z.string().nullable().optional(),
   239→  docsUrl: z.string().nullable().optional()
   240→});
   241→
   242→export const PassionProjectsSchema = z.object({
   243→  projects: z.array(PassionProjectSchema)
   244→});
   245→
   246→// ------------------------------------------------------------------
   247→// BLOG POSTS
   248→// ------------------------------------------------------------------
   249→
   250→export const BlogPostSchema = z.object({
   251→  title: z.string(),
   252→  date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Date must be in YYYY-MM-DD format'),
   253→  excerpt: z.string(),
   254→  tags: z.array(z.string()),
   255→  thumbnail: z.string().nullable().optional(),
   256→  content: z.string()
   257→});
   258→
   259→// ------------------------------------------------------------------
   260→// VARIANT CV (Universal Portfolio)
   261→// ------------------------------------------------------------------
   262→
   263→/**
   264→ * Metadata about the variant generation
   265→ */
   266→const VariantMetadataSchema = z.object({
   267→  company: z.string(),
   268→  role: z.string(),
   269→  generatedAt: z.string(),
   270→  jobDescription: z.string(),
   271→  generationModel: z.string().optional(), // e.g., "claude-3-5-sonnet-20241022"
   272→  slug: z.string() // e.g., "bloomberg-senior-engineer"
   273→});
   274→
   275→/**
   276→ * Experience override - allows tailoring job highlights per variant
   277→ */
   278→const ExperienceOverrideSchema = z.object({
   279→  company: z.string(), // Match by company name
   280→  highlights: z.array(z.string()).optional(), // Override highlights for this company
   281→  tags: z.array(z.string()).optional() // Override tags for this company
   282→});
   283→
   284→/**
   285→ * Overrides for profile fields specific to this variant
   286→ * All fields optional - only override what's relevant for the job
   287→ */
   288→const VariantOverridesSchema = z.object({
   289→  hero: z.object({
   290→    status: z.string().optional(),
   291→    headline: z.array(HeadlineSegmentSchema).optional(),
   292→    subheadline: z.string().optional(),
   293→    // Company accent - shown below signature headline to help recruiters visualize fit
   294→    companyAccent: z.array(HeadlineSegmentSchema).optional()
   295→  }).optional(),
   296→  about: z.object({
   297→    tagline: z.string().optional(),
   298→    bio: z.array(z.string()).optional(),
   299→    stats: z.array(StatSchema).optional()
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Let me continue reading the schema:

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Tool use: **Read** `./src/lib/schemas.ts`

Result:

```
300→  }).optional(),
   301→  sections: z.object({
   302→    beyondWork: z.boolean().optional(),
   303→    blog: z.boolean().optional(),
   304→    onchainIdentity: z.boolean().optional(),
   305→    skills: z.boolean().optional(),
   306→    passionProjects: z.boolean().optional()
   307→  }).optional(),
   308→  // Experience customization - tailor highlights per company for this job
   309→  experience: z.array(ExperienceOverrideSchema).optional()
   310→});
   311→
   312→/**
   313→ * Relevance rankings for existing content
   314→ * AI determines which case studies, projects, skills to emphasize
   315→ */
   316→const VariantRelevanceSchema = z.object({
   317→  caseStudies: z.array(z.object({
   318→    slug: z.string(),
   319→    relevanceScore: z.number().min(0).max(1),
   320→    reasoning: z.string().optional()
   321→  })).optional(),
   322→  skills: z.array(z.object({
   323→    category: z.string(),
   324→    relevanceScore: z.number().min(0).max(1)
   325→  })).optional(),
   326→  projects: z.array(z.object({
   327→    slug: z.string(),
   328→    relevanceScore: z.number().min(0).max(1),
   329→    reasoning: z.string().optional()
   330→  })).optional()
   331→});
   332→
   333→/**
   334→ * Complete variant schema - combines metadata, overrides, and relevance
   335→ */
   336→export const VariantSchema = z.object({
   337→  metadata: VariantMetadataSchema,
   338→  overrides: VariantOverridesSchema,
   339→  relevance: VariantRelevanceSchema.optional()
   340→});
   341→
```

_**Agent (claude-haiku-4-5-20251001) (sidechain)**_

Perfect! Now let me create a comprehensive report summarizing everything I found:

## CLI Implementation Analysis Report

Based on my thorough exploration of the codebase, here's a comprehensive overview of the CLI implementation:

---

## 1. CLI Commands Overview

The portfolio has a **Universal CV Quality Pipeline** with these main CLI commands (defined in `package.json`):

### Sync Phase
```bash
npm run variants:sync              # Convert YAML variants → JSON (deterministic)
npm run variants:sync -- --slug    # Sync single variant
npm run variants:check             # Check mode (exit 1 if drift detected)
```

### Evaluation Phase
```bash
npm run eval:variant -- --slug     # Evaluate claims in one variant
npm run eval:all                   # Evaluate all variants
npm run eval:check                 # Gate check (fail if unverified claims)
npm run eval:variant -- --verify   # Mark specific claims as verified
```

### Red Team Phase
```bash
npm run redteam:variant -- --slug  # Run security/quality scan on one variant
npm run redteam:all                # Scan all variants
npm run redteam:check              # Gate check (fail on FAIL results)
npm run redteam:check -- --strict  # Strict mode (WARN becomes FAIL)
```

### Other Commands
```bash
npm run validate                   # Validate all content files
npm run generate:cv                # Generate CV files
```

---

## 2. Architecture & Flow

### High-Level Pipeline Flow
```
YAML Variants (canonical)
    ↓ [variants:sync]
JSON Variants (runtime artifacts)
    ↓ [eval:variant]
Claims Ledger (extracted metrics + candidate sources)
    ↓ [Manual verification]
Verified Claims + Sources
    ↓ [redteam:variant]
Red Team Report (8 security/quality checks)
    ↓ [Gate checks: eval:check + redteam:check]
✅ Safe to deploy
```

### The Core Principle: "Truth → Output → Evaluation → Red Team → Ship"

1. **Truth**: Knowledge base (`content/knowledge/`) is the single source of facts
2. **Output**: Variants (`content/variants/`) personalize for job opportunities
3. **Evaluation**: Claims ledger proves all metrics are sourced
4. **Red Team**: Scans for secrets, tone issues, and hallucinations
5. **Ship**: Deploy only if gates pass

---

## 3. Implementation Files

### Main CLI Scripts (`scripts/`)

#### `/scripts/sync-variants.ts` (225 lines)
**Purpose**: Ensure YAML/JSON variants stay in sync

**Key Features**:
- Reads all `content/variants/*.yaml` files
- Validates against `VariantSchema` (Zod)
- Writes deterministic JSON: `JSON.stringify(obj, null, 2) + '\n'`
- Status tracking: `created`, `updated`, `synced`, `error`
- Output modes: interactive (with spinner + colors) or `--json` for CI
- Slug mismatch detection

**Key Functions**:
- `parseArgs()` - CLI argument parser
- `listVariantYamlFiles()` - Find YAML files
- `syncOneVariant()` - Single variant sync logic
- `stableJson()` - Deterministic JSON stringification

#### `/scripts/evaluate-variants.ts` (678 lines)
**Purpose**: Extract metric claims and verify against knowledge base

**Key Features**:
- Extracts "metric-like" claims from variant text (numbers, %, $, ×, +, "billions", etc.)
- Searches knowledge base for candidate sources
- Generates `claims.yaml` (machine-readable ledger) + `eval.md` (human checklist)
- Claim persistence: preserves verification status across re-runs
- Hash-based regression detection: validates anchors still exist in sources
- Interactive output with spinner

**Key Functions**:
- `parseArgs()` - Support `--slug`, `--all`, `--check`, `--verify`, `--json`
- `extractAnchors()` - Regex-based metric detection (dollar amounts, percentages, time periods, etc.)
- `tokenize()` - Text normalization for semantic matching
- `loadKnowledgeSources()` - Load KB from `content/knowledge/achievements` and `content/knowledge/stories`
- `candidateSourcesForClaim()` - Score KB files by anchor match + token overlap
- `checkLedgerStrict()` - Validate ledger hash, verify all claims, check anchors exist
- `buildLedger()` - Main ledger generation

**Claims Ledger Structure**:
```yaml
version: 1
variant:
  slug: "acme-senior-pm"
  variantFile: "content/variants/acme-senior-pm.yaml"
  contentHash: "sha256..."
  evaluatedAt: "2025-12-21T18:30:00Z"
claims:
  - id: "metric-abc123"
    location: "overrides.hero.subheadline"
    text: "Senior PM with 8 years..."
    anchors: ["8 years"]
    candidateSources:
      - path: "content/experience/index.yaml"
        score: 0.85
        matchedAnchors: ["8 years"]
    verified:
      status: "unverified" | "verified"
      sources: ["content/knowledge/achievements/...yaml"]
      notes: "..."
```

#### `/scripts/redteam.ts` (493 lines)
**Purpose**: Adversarial scanning for security, accuracy, and tone risks

**Key Features**:
- 8 built-in checks (see below)
- Generates `redteam/<slug>.redteam.md` markdown report
- Results sorted: FAIL first, then WARN, then PASS
- Supports `--strict` mode (WARN becomes FAIL)

**8 Red Team Checks**:

| ID | Severity | What It Catches |
|----|----------|-----------------|
| `RT-ACC-CLAIMS` | FAIL | Missing/unverified claims ledger |
| `RT-SEC-SECRETS` | FAIL | API keys (sk-*, ghp_*, AKIA*), private key headers |
| `RT-SEC-CONFIDENTIAL` | FAIL | NDA/confidential/proprietary language |
| `RT-TONE-SYCOPHANCY` | WARN | "thrilled", "dream company", "inspired by", etc. |
| `RT-ACC-INFLATION` | WARN | Approximation words ("about", "roughly") near metrics |
| `RT-INPUT-INJECTION` | WARN | Prompt injection in job description |
| `RT-PRIV-JD` | WARN | Job description >1200 chars (public JSON exposure) |
| `RT-XVAR-CONTAM` | WARN | Mentions other target company names |

**Key Functions**:
- `scanSecrets()` - 7 regex patterns for API keys
- `scanConfidential()` - Detects NDA/confidential language
- `scanSycophancy()` - Catches fawning/insincere phrasing
- `scanClaimsLedger()` - Enforces all claims verified
- `redteamOne()` - Run all checks for one variant
- `writeReport()` - Generate markdown report

#### `/scripts/cli/theme.ts` (170 lines)
**Purpose**: Consistent CLI styling and output

**Features**:
- Brand colors from design system (globals.css)
- Semantic functions: `theme.success()`, `theme.warning()`, `theme.error()`
- Status icons: ✓, ✗, ⚠, ℹ
- Utilities: `header()`, `box()`, `kv()`, `li()`, `step()`, `progressBar()`
- ANSI code stripping for width calculations
- Interactive mode detection

#### `/scripts/validate-content.ts` (234 lines)
**Purpose**: Pre-commit validation of all content files

**Validates**:
- Single YAML files: `profile.yaml`, `experience/index.yaml`, etc.
- Case studies (markdown with frontmatter)
- Blog posts
- Variants

---

## 4. CLI Architecture Patterns

### Argument Parsing
Custom parser in each script (not using external CLI framework):
```typescript
function parseArgs(): Args {
  const argv = process.argv.slice(2);
  const out = { ... };
  for (let i = 0; i < argv.length; i++) {
    const a = argv[i];
    if (a === '--slug') {
      out.slug = argv[i + 1];
      i++;
    }
    // ...
  }
  return out;
}
```

### Output Modes
Every CLI supports:
- **Interactive**: Spinner + colored output (default)
- **JSON**: Machine-readable output (`--json` flag)
- **Quiet**: Minimal output (`--quiet` flag)

Example (sync-variants.ts):
```typescript
if (args.json) {
  const output = {
    mode: args.check ? 'check' : 'sync',
    variants: results.filter(r => r.status !== 'error'),
    errors: results.filter(r => r.status === 'error')
  };
  console.log(JSON.stringify(output, null, 2));
  process.exit(output.errors.length > 0 ? 1 : 0);
}

// Interactive output
console.log(HEADER_COMPACT);
// ... render with colors and spinner
```

### Error Handling
- Early validation: schemas parsed with Zod
- Try-catch wraps file operations
- Exit codes: `0` success, `1` failure (for CI integration)

---

## 5. Data Structures

### VariantSchema (Zod)
```typescript
export const VariantSchema = z.object({
  metadata: {
    slug: string                    // Must match filename
    company: string                 // Target company
    role: string                    // Target job title
    jobDescription: string          // Job posting excerpt (<1200 chars)
    generatedAt: string
    generationModel?: string        // e.g., "claude-3-5-sonnet-20241022"
  },
  overrides: {
    hero?: {
      status?: string
      headline?: HeadlineSegment[]
      subheadline?: string
      companyAccent?: HeadlineSegment[]
    },
    about?: {
      tagline?: string
      bio?: string[]
      stats?: { value: string, label: string }[]
    },
    sections?: {
      beyondWork?: boolean
      blog?: boolean
      onchainIdentity?: boolean
      skills?: boolean
      passionProjects?: boolean
    },
    experience?: ExperienceOverride[]  // Tailor highlights per company
  },
  relevance?: {
    caseStudies?: { slug: string, relevanceScore: 0-1, reasoning?: string }[]
    skills?: { category: string, relevanceScore: 0-1 }[]
    projects?: { slug: string, relevanceScore: 0-1, reasoning?: string }[]
  }
});
```

---

## 6. Documentation

### User-Facing Guides
- **`docs/guides/universal-cv-cli.md`** (651 lines) - Complete CLI reference
  - Phase-by-phase walkthrough (Sync → Evaluate → Red Team → Ship)
  - Example workflow for creating `acme-senior-pm` variant
  - Troubleshooting section
  - CLI flags reference
  - Quick reference card

- **`docs/guides/capstone-workflow.md`** (364 lines) - Step-by-step working example
  - Using `mysten-walrus-senior-pm` as a concrete example
  - File locations reference table
  - Understanding the claims ledger
  - Fixing red team failures

### Architectural Documentation
- **`capstone/develop/README.md`** - Architecture overview, implementation status, data schemas
- **`capstone/develop/executable-quality-pipeline.md`** - Layers (conceptual + executable), phase breakdown
- **`capstone/develop/red-teaming.md`** - Threat model, threat categories, mitigations (100+ lines)
- **`capstone/develop/evals/README.md`** - Claims ledger format
- **`capstone/develop/redteam/README.md`** - Red team report format

---

## 7. Phases/Workflows Currently Structured

### Phase 1: Sync (YAML → JSON)
- **Input**: `content/variants/*.yaml` (canonical, human-editable)
- **Output**: `content/variants/*.json` (runtime artifact, deterministic)
- **Command**: `npm run variants:sync` / `npm run variants:check`
- **Validation**: Zod schema check + slug matching
- **Status Tracking**: `created`, `updated`, `synced`, `error`

### Phase 2: Evaluate (Claims Extraction & Verification)
- **Input**: `content/variants/<slug>.yaml` + knowledge base
- **Output**: 
  - `capstone/develop/evals/<slug>.claims.yaml` (machine-readable ledger)
  - `capstone/develop/evals/<slug>.eval.md` (human checklist)
- **Command**: `npm run eval:variant -- --slug <slug>` / `npm run eval:all`
- **Gate**: `npm run eval:check` (fails if unverified claims)
- **Key Feature**: Hash-based change detection + persistent verification state

### Phase 3: Red Team (Security/Quality Scans)
- **Input**: `content/variants/<slug>.yaml` + claims ledger
- **Output**: `capstone/develop/redteam/<slug>.redteam.md`
- **Command**: `npm run redteam:variant -- --slug <slug>` / `npm run redteam:all`
- **Gate**: `npm run redteam:check` (fails on FAIL, warns on WARN)
- **Strict Mode**: `npm run redteam:check -- --strict` (WARN = FAIL)
- **8 Checks**: Accuracy, security, tone, exposure, contamination

### Phase 4: Ship (Deployment)
- **Precondition**: All gates must pass
  ```bash
  npm run variants:check &&
  npm run eval:check &&
  npm run redteam:check &&
  npm run build
  ```
- **Output**: Optimized build for deployment
- **Monitoring**: (Framework exists, execution TBD)

---

## 8. Key Design Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| File Storage | YAML (source) + JSON (runtime) | Git-friendly, reviewable, deterministic |
| Knowledge Base | File-based (not DB) | No backend, static deployment compatible |
| Skill Framework | Claude Code Skills | Integrated workflow, no API costs |
| Claims Format | YAML ledger | Machine-checkable, human-readable |
| Validation | Zod schemas | Type-safe, provides detailed errors |
| CLI Framework | Custom parser | Lightweight, no dependencies for core logic |
| Red Team Checks | Regex patterns + hardcoded rules | Fast, deterministic, no AI hallucination risk |

---

## 9. Current Status

### Implemented & Working
- ✅ Variant sync (YAML ↔ JSON)
- ✅ Claims extraction (metric detection)
- ✅ Candidate source finding (semantic matching)
- ✅ Red team scans (8 checks)
- ✅ Gate checks (evaluation & red team)
- ✅ Interactive CLI with colored output
- ✅ JSON output for CI
- ✅ Comprehensive documentation

### In Progress / Planned
- 🟡 More variant examples (currently have 4+)
- 🟡 Automated claim verification via Claude
- 🟡 Analytics integration
- 🟡 A/B testing framework

### Known Limitations
- Claims require manual verification (extraction is automatic, but `verified: true` must be set manually)
- Red team checks are static regex/rule-based (not AI-powered)
- No interactive CLI mode (all args passed as flags)

---

## 10. Example Directory Structure

```
portfolio/
├── content/
│   ├── variants/
│   │   ├── _template.yaml                    ← Start here
│   │   ├── acme-senior-pm.yaml               ← Canonical (EDIT THIS)
│   │   ├── acme-senior-pm.json               ← Auto-generated
│   │   ├── bloomberg-technical-product-manager.yaml
│   │   └── ...
│   │
│   └── knowledge/
│       ├── achievements/
│       │   ├── _template.yaml
│       │   ├── eth-staking-zero-slashing.yaml
│       │   └── ...
│       └── stories/
│           └── galaxy-compliance-win.yaml
│
├── capstone/develop/
│   ├── evals/
│   │   ├── acme-senior-pm.claims.yaml        ← Claims ledger
│   │   ├── acme-senior-pm.eval.md            ← Human checklist
│   │   └── README.md
│   │
│   ├── redteam/
│   │   ├── acme-senior-pm.redteam.md         ← Red team report
│   │   └── README.md
│   │
│   ├── evaluation.md                         ← Rubric docs
│   ├── red-teaming.md                        ← Threat model
│   └── README.md
│
├── scripts/
│   ├── sync-variants.ts
│   ├── evaluate-variants.ts
│   ├── redteam.ts
│   ├── validate-content.ts
│   └── cli/
│       └── theme.ts
│
└── docs/guides/
    ├── universal-cv-cli.md                   ← User guide
    └── capstone-workflow.md                  ← Example walkthrough
```

---

## Summary

This is a **production-grade CLI quality pipeline** that operationalizes a portfolio evaluation and red-teaming framework. It follows a deliberate **"Truth → Output → Evaluation → Red Team → Ship"** cycle with:

1. **Canonical variants in YAML**, runtime artifacts in JSON
2. **Machine-checkable claims ledger** extracted from metrics
3. **8-check red team scan** for security, accuracy, and tone
4. **Git-friendly, fully documented**, designed for CI/CD integration
5. **Interactive + JSON output modes** for both humans and automation

The implementation is clean, well-structured, and emphasizes **traceability** and **auditability** over automation—every claim must be verified against a source, and all decisions are logged and reviewable.

